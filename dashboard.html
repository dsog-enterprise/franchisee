<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DSOG Franchise Portal - Login</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
    <link rel="icon" href="https://i.postimg.cc/kMZ1jTww/Untitled-design-4-removebg-preview.png">
    <!-- Load Google Identity Services library -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
<body>
    <div class="login-container">
        <div class="login-header">
            <img src="https://i.postimg.cc/kMZ1jTww/Untitled-design-4-removebg-preview.png" alt="DSOG Logo" class="logo">
            <h1>DSOG Franchise Portal</h1>
            <p>Access your online fashion franchise dashboard</p>
        </div>
        
        <div class="login-form">
            <div id="loginMessage" class="message"></div>
            
            <!-- Google Sign-in Only Section -->
            <div class="google-only-section">
                <h3>Sign in to Continue</h3>
                <p>Please use your authorized Google account to access the franchise portal</p>
                
                <!-- Google Sign-in Button Container -->
                <div id="g_id_onload"
                     data-client_id="369304497158-8ub6b68v2bjvsfciome6q56flh2rd1m4.apps.googleusercontent.com"
                     data-context="signin"
                     data-ux_mode="popup"
                     data-callback="handleGoogleResponse"
                     data-auto_prompt="false"
                     data-auto_select="true">
                </div>

                <div class="google-login-section">
                    <div class="g_id_signin"
                         data-type="standard"
                         data-size="large"
                         data-theme="outline"
                         data-text="signin_with"
                         data-shape="rectangular"
                         data-logo_alignment="left"
                         data-width="300">
                    </div>
                </div>
                
                <div class="login-info">
                    <p><i class="fas fa-info-circle"></i> Only authorized DSOG franchise partner accounts can access this portal.</p>
                    <p><i class="fas fa-envelope"></i> For access issues, contact: <strong>office.dsog@gmail.com</strong></p>
                    <p><i class="fas fa-phone"></i> Call support: <strong>0733 737 983</strong></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Add config file -->
    <script src="config.js"></script>
    <!-- Add main app with Google OAuth logic -->
    <script src="app.js"></script>
    <script>
        // Handle Google OAuth response
        async function handleGoogleResponse(response) {
            const messageDiv = document.getElementById('loginMessage');
            try {
                // Decode JWT token
                const base64Url = response.credential.split('.')[1];
                const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
                const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
                    return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
                }).join(''));
                
                const userData = JSON.parse(jsonPayload);
                
                // Show success message
                messageDiv.className = 'message message-success';
                messageDiv.innerHTML = `<i class="fas fa-check-circle"></i> Welcome ${userData.name}! Redirecting to dashboard...`;
                messageDiv.style.display = 'block';
                
                // Store user data
                localStorage.setItem('dsog_user', JSON.stringify({
                    name: userData.name,
                    email: userData.email,
                    picture: userData.picture,
                    franchise_code: 'FR-' + userData.sub.slice(0, 8).toUpperCase(),
                    role: 'franchise_owner'
                }));
                
                localStorage.setItem('dsog_token', response.credential);
                localStorage.setItem('auth_method', 'google');
                
                // Redirect to dashboard after 1 second
                setTimeout(() => {
                    window.location.href = 'dashboard.html';
                }, 1000);
                
            } catch (error) {
                console.error('Google auth error:', error);
                messageDiv.className = 'message message-error';
                messageDiv.innerHTML = `<i class="fas fa-exclamation-triangle"></i> Authentication failed. Please try again.`;
                messageDiv.style.display = 'block';
            }
        }
        
        // Auto-redirect if already logged in
        document.addEventListener('DOMContentLoaded', function() {
            const user = localStorage.getItem('dsog_user');
            const token = localStorage.getItem('dsog_token');
            
            if (user && token) {
                // Already logged in, redirect to dashboard
                setTimeout(() => {
                    window.location.href = 'dashboard.html';
                }, 500);
            }
        });
    </script>
</body>
</html>
