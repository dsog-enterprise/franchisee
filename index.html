<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=0.7, maximum-scale=1.0, user-scalable=no">
    
    <!-- App Version -->
    <meta name="app-version" content="2.6.0">
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#B22222">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="DSOG FRANCHISE">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="DSOG FRANCHISE">
    <meta name="msapplication-TileColor" content="#B22222">
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="DSOG Franchise | Order Management Platform">
    <meta property="og:description" content="Professional order management for DSOG franchisees">
    <meta property="og:image" content="https://i.postimg.cc/kMZ1jTww/Untitled-design-4-removebg-preview.png">
    <meta property="og:url" content="https://dsogstores.com/franchise">
    <meta property="og:type" content="website">
    
    <title>DSOG FRANCHISE | Order Management Platform</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/franchise-manifest.json" crossorigin="use-credentials">
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" sizes="180x180" href="https://i.postimg.cc/kMZ1jTww/Untitled-design-4-removebg-preview.png">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="https://i.postimg.cc/kMZ1jTww/Untitled-design-4-removebg-preview.png">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Sign-in SDK -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    
    <!-- FIRST PAGE'S THEME AND STYLES -->
    <style>
        :root {
            --primary-red: #B22222;
            --primary-black: #000000;
            --primary-gold: #D4AF37;
            --secondary-red: #8B0000;
            --secondary-black: #1a1a1a;
            --light-red: #FF6B6B;
            --dark-red: #8B0000;
            --light: #F5F5F5;
            --gray: #777777;
            --white: #FFFFFF;
            --text-primary: #222222;
            --text-secondary: #5a5a5a;
            --bg-primary: #ffffff;
            --bg-secondary: #f8f8f8;
            --border-color: #e0e0e0;
            --shadow-color: rgba(178, 34, 34, 0.08);
            --card-bg: #ffffff;
            --success: #25D366;
            --whatsapp-green: #25D366;
            --whatsapp-dark: #128C7E;
            --share-blue: #4285F4;
            --google-blue: #4285F4;
            --google-red: #EA4335;
            --google-yellow: #FBBC05;
            --google-green: #34A853;
            --shadow-sm: 0 2px 8px rgba(0,0,0,0.05);
            --shadow-md: 0 4px 12px rgba(178, 34, 34, 0.1);
            --shadow-lg: 0 10px 25px rgba(178, 34, 34, 0.15);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            background: var(--bg-secondary);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
        }
        
        /* FIXED HEADER (Similar to first page) */
        header {
            background: var(--primary-black);
            padding: 1rem 1.5rem;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 20px rgba(0,0,0,0.2);
            border-bottom: 3px solid var(--primary-red);
        }
        
        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 1rem;
        }
        
        .logo {
            height: 35px;
            filter: drop-shadow(0 2px 4px rgba(212, 175, 55, 0.3));
        }
        
        /* User Profile in Header */
        .user-profile-header {
            display: flex;
            align-items: center;
            gap: 0.8rem;
            margin-left: auto;
            margin-right: 1rem;
            cursor: pointer;
        }
        
        .user-avatar {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-red), var(--primary-gold));
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-weight: bold;
            font-size: 0.9rem;
            border: 2px solid var(--primary-gold);
            overflow: hidden;
            background-size: cover;
            background-position: center;
        }
        
        .user-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .user-name {
            color: var(--white);
            font-size: 0.9rem;
            font-weight: 500;
            display: none;
        }
        
        @media (min-width: 768px) {
            .user-name {
                display: block;
            }
        }
        
        /* Google Sign-in Container */
        .gsi-container {
            display: flex;
            justify-content: center;
            margin: 1rem 0;
        }
        
        /* Hamburger Menu */
        .hamburger {
            display: none;
            flex-direction: column;
            cursor: pointer;
            background: none;
            border: none;
            padding: 8px;
            position: relative;
            z-index: 1001;
            transition: var(--transition);
        }
        
        .hamburger span {
            width: 25px;
            height: 2px;
            background: var(--white);
            margin: 4px 0;
            transition: var(--transition);
            border-radius: 2px;
        }
        
        .hamburger.active span:nth-child(1) {
            transform: rotate(-45deg) translate(-6px, 6px);
            background: var(--primary-red);
        }
        
        .hamburger.active span:nth-child(2) {
            opacity: 0;
        }
        
        .hamburger.active span:nth-child(3) {
            transform: rotate(45deg) translate(-6px, -6px);
            background: var(--primary-red);
        }
        
        /* Desktop Navigation */
        .nav-links {
            display: flex;
            gap: 2rem;
            align-items: center;
        }
        
        .nav-links a {
            color: var(--white);
            text-decoration: none;
            font-weight: 500;
            transition: var(--transition);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            position: relative;
            padding: 0.4rem 0;
        }
        
        .nav-links a::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 2px;
            background: var(--primary-red);
            transition: var(--transition);
        }
        
        .nav-links a:hover {
            color: var(--primary-red);
        }
        
        .nav-links a:hover::after {
            width: 100%;
        }
        
        .nav-links a.active {
            color: var(--primary-red);
        }
        
        .nav-links a.active::after {
            width: 100%;
        }
        
        /* Mobile Menu */
        .mobile-menu {
            position: fixed;
            top: 0;
            right: -100%;
            width: 280px;
            height: 100vh;
            background: var(--primary-black);
            padding: 5rem 2rem 2rem;
            transition: var(--transition);
            z-index: 999;
            box-shadow: -5px 0 25px rgba(0,0,0,0.3);
            overflow-y: auto;
        }
        
        .mobile-menu.active {
            right: 0;
        }
        
        .mobile-nav-links {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .mobile-nav-links a {
            color: var(--white);
            text-decoration: none;
            font-size: 1.1rem;
            padding: 1rem 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            transition: var(--transition);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .mobile-nav-links a:hover {
            color: var(--primary-red);
            padding-left: 10px;
        }
        
        .menu-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 998;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
        }
        
        .menu-backdrop.active {
            opacity: 1;
            visibility: visible;
        }
        
        .close-menu {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            color: var(--white);
            font-size: 1.5rem;
            cursor: pointer;
            transition: var(--transition);
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }
        
        .close-menu:hover {
            background: var(--primary-red);
            transform: rotate(90deg);
        }
        
        /* INSTALL APP BUTTON */
        .install-app-btn {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: var(--primary-red);
            color: var(--white);
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 30px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 600;
            text-decoration: none;
        }
        
        .install-app-btn:hover {
            background: var(--secondary-red);
            transform: translateY(-2px);
        }
        
        /* GOOGLE SIGN-IN MODAL */
        .google-signin-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.95);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2005;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
            padding: 1rem;
        }
        
        .google-signin-modal.active {
            opacity: 1;
            visibility: visible;
        }
        
        .google-signin-content {
            background: var(--white);
            border-radius: 15px;
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            animation: modalSlideIn 0.3s ease;
            border: 3px solid var(--primary-red);
            box-shadow: var(--shadow-lg);
        }
        
        .google-signin-header {
            background: var(--primary-black);
            color: var(--white);
            padding: 1.5rem;
            border-radius: 12px 12px 0 0;
            text-align: center;
            border-bottom: 3px solid var(--primary-red);
        }
        
        .google-signin-header h2 {
            color: var(--primary-gold);
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        
        .google-signin-body {
            padding: 2rem;
            text-align: center;
        }
        
        .google-signin-icon {
            font-size: 4rem;
            color: var(--google-blue);
            margin-bottom: 1.5rem;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .google-signin-title {
            font-size: 1.8rem;
            color: var(--text-primary);
            margin-bottom: 1rem;
            font-weight: 600;
        }
        
        .google-signin-description {
            color: var(--text-secondary);
            margin-bottom: 2rem;
            line-height: 1.6;
            font-size: 1.1rem;
        }
        
        .google-signin-requirements {
            background: var(--bg-secondary);
            padding: 1.5rem;
            border-radius: 10px;
            margin-bottom: 2rem;
            text-align: left;
            border: 1px solid var(--border-color);
        }
        
        .google-signin-requirements h3 {
            color: var(--primary-red);
            margin-bottom: 1rem;
            font-size: 1.2rem;
        }
        
        .requirements-list {
            list-style-type: none;
        }
        
        .requirements-list li {
            margin-bottom: 0.8rem;
            padding-left: 1.5rem;
            position: relative;
            color: var(--text-secondary);
        }
        
        .requirements-list li::before {
            content: 'âœ“';
            position: absolute;
            left: 0;
            color: var(--success);
            font-weight: bold;
        }
        
        .google-signin-note {
            margin-top: 1.5rem;
            padding: 1rem;
            background: rgba(66, 133, 244, 0.1);
            border-radius: 8px;
            border-left: 4px solid var(--google-blue);
            font-size: 0.9rem;
            color: var(--text-secondary);
            text-align: left;
        }
        
        /* User Profile Modal */
        .user-profile-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.95);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2004;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
            padding: 1rem;
        }
        
        .user-profile-modal.active {
            opacity: 1;
            visibility: visible;
        }
        
        .profile-content {
            background: var(--white);
            border-radius: 15px;
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            animation: modalSlideIn 0.3s ease;
            border: 3px solid var(--primary-red);
            box-shadow: var(--shadow-lg);
        }
        
        .profile-header {
            background: var(--primary-black);
            color: var(--white);
            padding: 1.5rem;
            border-radius: 12px 12px 0 0;
            text-align: center;
            border-bottom: 3px solid var(--primary-red);
            position: relative;
        }
        
        .profile-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: var(--primary-red);
            color: var(--white);
            border: none;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }
        
        .profile-close:hover {
            background: var(--secondary-red);
            transform: rotate(90deg);
        }
        
        .profile-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-red), var(--primary-gold));
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-size: 2rem;
            font-weight: bold;
            margin: 0 auto 1rem;
            border: 3px solid var(--primary-gold);
            overflow: hidden;
            background-size: cover;
            background-position: center;
        }
        
        .profile-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .profile-body {
            padding: 2rem;
        }
        
        .profile-info {
            margin-bottom: 2rem;
        }
        
        .profile-actions {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .profile-btn {
            padding: 1rem;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        
        .profile-btn-primary {
            background: var(--primary-red);
            color: var(--white);
        }
        
        .profile-btn-primary:hover {
            background: var(--secondary-red);
            transform: translateY(-2px);
        }
        
        .profile-btn-google {
            background: var(--google-blue);
            color: var(--white);
        }
        
        .profile-btn-google:hover {
            background: #3367d6;
            transform: translateY(-2px);
        }
        
        .profile-btn-secondary {
            background: var(--bg-secondary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }
        
        .profile-btn-secondary:hover {
            background: var(--border-color);
        }
        
        .sign-out-btn {
            background: var(--google-red);
            color: var(--white);
        }
        
        .sign-out-btn:hover {
            background: #d3342d;
            transform: translateY(-2px);
        }
        
        /* PWA INSTALL PROMPT */
        .pwa-install-prompt {
            position: fixed;
            bottom: 100px;
            left: 20px;
            right: 20px;
            background: var(--primary-black);
            color: var(--white);
            padding: 1.2rem;
            border-radius: 15px;
            box-shadow: var(--shadow-lg);
            z-index: 2000;
            display: none;
            flex-direction: column;
            gap: 1rem;
            border: 2px solid var(--primary-red);
            animation: slideUp 0.3s ease;
            max-width: 400px;
            margin: 0 auto;
        }
        
        @keyframes slideUp {
            from {
                transform: translateY(100px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .pwa-install-header {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .pwa-install-icon {
            width: 50px;
            height: 50px;
            border-radius: 10px;
            background: var(--primary-red);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            border: 2px solid var(--primary-gold);
        }
        
        .pwa-install-title {
            font-weight: 600;
            font-size: 1.1rem;
            color: var(--white);
        }
        
        .pwa-install-subtitle {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-top: 0.2rem;
        }
        
        .pwa-install-buttons {
            display: flex;
            gap: 0.8rem;
            justify-content: flex-end;
        }
        
        .pwa-install-btn {
            padding: 0.7rem 1.5rem;
            border: none;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.9rem;
        }
        
        .pwa-install-primary {
            background: var(--primary-red);
            color: var(--white);
        }
        
        .pwa-install-primary:hover {
            background: var(--secondary-red);
            transform: translateY(-2px);
        }
        
        .pwa-install-secondary {
            background: transparent;
            color: var(--white);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .pwa-install-secondary:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .pwa-install-close {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            color: var(--white);
            opacity: 0.7;
            cursor: pointer;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: var(--transition);
        }
        
        .pwa-install-close:hover {
            background: var(--primary-red);
            opacity: 1;
        }
        
        /* PRODUCTS SECTION - ADAPTED FROM FIRST PAGE */
        .products {
            max-width: 1400px;
            margin: 3rem auto;
            padding: 0 1.5rem;
            padding-bottom: 120px;
        }
        
        .section-title {
            text-align: center;
            margin-bottom: 2.5rem;
            position: relative;
            display: inline-block;
            width: 100%;
        }
        
        .section-title h2 {
            font-size: clamp(1.6rem, 3.5vw, 2.2rem);
            color: var(--text-primary);
            margin-bottom: 0.8rem;
            font-weight: 700;
            position: relative;
            display: inline-block;
        }
        
        .section-title h2::after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 3px;
            background: var(--primary-red);
        }
        
        .section-title p {
            color: var(--gray);
            max-width: 500px;
            margin: 0 auto;
            font-size: 0.9rem;
            line-height: 1.6;
        }
        
        /* Product Filter Bar */
        .product-filters {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            padding: 1rem;
            background: var(--card-bg);
            border-radius: 10px;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
        }
        
        .filter-btn {
            padding: 0.6rem 1.5rem;
            border: 2px solid var(--border-color);
            background: var(--white);
            color: var(--text-primary);
            border-radius: 30px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
            font-size: 0.9rem;
            white-space: nowrap;
        }
        
        .filter-btn:hover {
            border-color: var(--primary-red);
            color: var(--primary-red);
            transform: translateY(-2px);
        }
        
        .filter-btn.active {
            background: var(--primary-red);
            color: var(--white);
            border-color: var(--primary-red);
        }
        
        /* UPDATED: Products Grid with Larger Images */
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 2rem;
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.5s ease, transform 0.5s ease;
        }
        
        .products-grid.loaded {
            opacity: 1;
            transform: translateY(0);
        }
        
        /* ENHANCED PRODUCT CARD STYLING - FROM FIRST PAGE */
        .product-card {
            background: var(--card-bg);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--shadow-sm);
            transition: var(--transition);
            cursor: pointer;
            border: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            height: 100%;
            opacity: 0;
            transform: translateY(10px);
            animation: fadeInUp 0.5s ease forwards;
            position: relative;
        }
        
        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .product-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-lg);
            border-color: var(--primary-red);
        }
        
        .product-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-red), var(--primary-gold));
            opacity: 0;
            transition: var(--transition);
            border-radius: 12px 12px 0 0;
            z-index: 1;
        }
        
        .product-card:hover::before {
            opacity: 1;
        }
        
        /* UPDATED: Larger Image Wrapper */
        .product-image-wrapper {
            position: relative;
            width: 100%;
            height: 350px;
            overflow: hidden;
            background: var(--bg-secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
        }
        
        .product-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.6s ease;
        }
        
        .product-card:hover .product-image {
            transform: scale(1.08);
        }
        
        .view-image-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(0,0,0,0.8);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transform: translateY(-10px);
            transition: var(--transition);
            z-index: 2;
            font-size: 1.1rem;
        }
        
        .product-image-wrapper:hover .view-image-btn {
            opacity: 1;
            transform: translateY(0);
        }
        
        .view-image-btn:hover {
            background: var(--primary-red);
            transform: scale(1.1);
        }
        
        /* UPDATED: Product Info - Cleaner Layout */
        .product-info {
            padding: 1.5rem;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            border-top: 1px solid var(--border-color);
            min-height: 150px;
        }
        
        .product-badge {
            background: linear-gradient(135deg, var(--primary-red) 0%, var(--secondary-red) 100%);
            color: var(--white);
            padding: 0.4rem 1rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            align-self: flex-start;
            margin-bottom: 1rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border: 1px solid var(--primary-gold);
        }
        
        .product-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 0.8rem;
            color: var(--text-primary);
            line-height: 1.4;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
            min-height: 3.2em;
            flex-shrink: 0;
        }
        
        .product-price {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary-red);
            margin-top: auto;
            padding-top: 0.5rem;
        }
        
        /* Cart Button Styling */
        .add-to-cart-btn {
            background: linear-gradient(135deg, var(--primary-red) 0%, var(--secondary-red) 100%);
            color: var(--white);
            border: none;
            padding: 0.8rem;
            border-radius: 0;
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            margin-top: 1rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-size: 0.9rem;
            position: relative;
            overflow: hidden;
        }
        
        .add-to-cart-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        
        .add-to-cart-btn.added {
            background: linear-gradient(135deg, #25D366 0%, #128C7E 100%);
            animation: cartAdded 0.5s ease;
        }
        
        @keyframes cartAdded {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        /* Cart Modal */
        .cart-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.98);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2001;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
            padding: 1rem;
        }
        
        .cart-modal.active {
            opacity: 1;
            visibility: visible;
        }
        
        .cart-modal-content {
            background: var(--white);
            border-radius: 0;
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            animation: modalSlideIn 0.3s ease;
            border: 2px solid var(--primary-red);
        }
        
        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: scale(0.9) translateY(20px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }
        
        .cart-header {
            background: var(--primary-black);
            color: var(--white);
            padding: 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid var(--primary-red);
        }
        
        .cart-header h2 {
            font-size: 1.5rem;
            color: var(--primary-gold);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .cart-close {
            background: var(--primary-red);
            color: var(--white);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }
        
        .cart-close:hover {
            background: var(--secondary-red);
            transform: rotate(90deg);
        }
        
        .cart-body {
            padding: 2rem;
            min-height: 300px;
        }
        
        .cart-empty {
            text-align: center;
            padding: 3rem;
            color: var(--gray);
        }
        
        .cart-empty i {
            font-size: 3rem;
            color: var(--light-red);
            margin-bottom: 1rem;
            opacity: 0.7;
        }
        
        .cart-empty p {
            margin-bottom: 1.5rem;
            font-size: 1.1rem;
        }
        
        .cart-items {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .cart-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            border: 1px solid var(--border-color);
            border-radius: 10px;
            background: var(--bg-secondary);
            transition: var(--transition);
        }
        
        .cart-item:hover {
            border-color: var(--primary-red);
            transform: translateX(5px);
        }
        
        .cart-item-image {
            width: 80px;
            height: 80px;
            border-radius: 8px;
            overflow: hidden;
            flex-shrink: 0;
            background: var(--bg-secondary);
        }
        
        .cart-item-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .cart-item-details {
            flex: 1;
            min-width: 0;
        }
        
        .cart-item-title {
            font-weight: 600;
            margin-bottom: 0.3rem;
            font-size: 1rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .cart-item-price {
            color: var(--primary-red);
            font-weight: bold;
            font-size: 1.1rem;
        }
        
        .cart-item-controls {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .quantity-control {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: var(--white);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            padding: 0.3rem 0.8rem;
        }
        
        .quantity-btn {
            background: none;
            border: none;
            color: var(--primary-red);
            cursor: pointer;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: var(--transition);
        }
        
        .quantity-btn:hover {
            background: var(--primary-red);
            color: var(--white);
        }
        
        .quantity-value {
            font-weight: 600;
            min-width: 30px;
            text-align: center;
        }
        
        .remove-item-btn {
            background: var(--light-red);
            color: var(--white);
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
            margin-left: 0.5rem;
        }
        
        .remove-item-btn:hover {
            background: var(--dark-red);
            transform: rotate(90deg);
        }
        
        .cart-summary {
            background: var(--bg-secondary);
            padding: 1.5rem;
            border-radius: 10px;
            margin-top: 2rem;
        }
        
        .summary-row {
            display: flex;
            justify-content: space-between;
            padding: 0.8rem 0;
            border-bottom: 1px solid var(--border-color);
        }
        
        .summary-row:last-child {
            border-bottom: none;
            font-weight: bold;
            font-size: 1.2rem;
            color: var(--primary-red);
        }
        
        /* Checkout Button for Franchise */
        .checkout-btn {
            width: 100%;
            background: linear-gradient(135deg, var(--primary-red), var(--secondary-red));
            color: var(--white);
            border: none;
            padding: 1.2rem;
            border-radius: 0;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.8rem;
            font-size: 1.1rem;
            transition: var(--transition);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .checkout-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(178, 34, 34, 0.4);
        }
        
        .checkout-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        /* Enhanced Product Modal (for franchise view) */
        .product-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.98);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
            padding: 1rem;
        }
        
        .product-modal.active {
            opacity: 1;
            visibility: visible;
        }
        
        .modal-content {
            background: var(--white);
            border-radius: 0;
            max-width: 1200px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            animation: modalSlideIn 0.3s ease;
            border: 2px solid var(--primary-red);
        }
        
        .modal-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: var(--primary-red);
            color: var(--white);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
            transition: var(--transition);
        }
        
        .modal-close:hover {
            background: var(--secondary-red);
            transform: rotate(90deg);
        }
        
        .modal-body {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 3rem;
            padding: 3rem;
        }
        
        .modal-image-container {
            width: 100%;
            height: 500px;
            border-radius: 8px;
            overflow: hidden;
            position: relative;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-main-image {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }
        
        .modal-details {
            display: flex;
            flex-direction: column;
            gap: 1.2rem;
        }
        
        .modal-title {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-primary);
            line-height: 1.3;
        }
        
        .modal-price {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--primary-red);
        }
        
        .modal-category {
            background: var(--primary-red);
            color: var(--white);
            padding: 0.6rem 1.2rem;
            border-radius: 30px;
            font-size: 0.9rem;
            align-self: flex-start;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .modal-description {
            color: var(--text-secondary);
            line-height: 1.7;
            font-size: 1rem;
            margin: 1rem 0;
            flex-grow: 1;
        }
        
        /* Enhanced Loading System */
        .products-loading {
            text-align: center;
            padding: 3rem;
            grid-column: 1 / -1;
            display: none;
        }
        
        .products-loading.visible {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 400px;
        }
        
        .loading-spinner-container {
            position: relative;
            width: 80px;
            height: 80px;
            margin-bottom: 1.5rem;
        }
        
        .loading-spinner {
            width: 100%;
            height: 100%;
            border: 3px solid rgba(178, 34, 34, 0.1);
            border-top: 3px solid var(--primary-red);
            border-right: 3px solid var(--primary-red);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading-logo {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 40px;
            height: 40px;
            background: var(--primary-black);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary-gold);
            font-weight: bold;
            font-size: 1.2rem;
        }
        
        .loading-message {
            margin-bottom: 1.5rem;
            font-size: 1.1rem;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .loading-progress-container {
            width: 100%;
            max-width: 300px;
            margin: 0 auto;
        }
        
        .loading-progress {
            width: 100%;
            height: 8px;
            background: var(--bg-secondary);
            border-radius: 4px;
            overflow: hidden;
            position: relative;
            margin-bottom: 0.5rem;
        }
        
        .loading-progress-bar {
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            background: linear-gradient(90deg, var(--primary-red), var(--primary-gold));
            width: 0%;
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 4px;
        }
        
        .loading-count {
            font-size: 0.9rem;
            color: var(--gray);
            text-align: center;
        }
        
        .loading-error {
            text-align: center;
            padding: 3rem;
            grid-column: 1 / -1;
            display: none;
        }
        
        .loading-error.visible {
            display: block;
        }
        
        .error-content {
            background: var(--white);
            padding: 2rem;
            border-radius: 10px;
            border: 1px solid var(--light-red);
            max-width: 400px;
            margin: 0 auto;
        }
        
        .error-content i {
            font-size: 2.5rem;
            color: var(--light-red);
            margin-bottom: 1rem;
        }
        
        .error-content h3 {
            color: var(--primary-red);
            margin-bottom: 0.5rem;
        }
        
        .retry-btn {
            background: var(--primary-red);
            color: var(--white);
            border: none;
            padding: 0.8rem 2rem;
            border-radius: 30px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            margin-top: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin: 1rem auto 0;
        }
        
        .retry-btn:hover {
            background: var(--secondary-red);
            transform: translateY(-2px);
        }
        
        /* Notification */
        .notification {
            position: fixed;
            top: 100px;
            right: 20px;
            background: var(--primary-red);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 30px;
            box-shadow: var(--shadow-lg);
            z-index: 1000;
            animation: slideIn 0.3s ease;
            max-width: 300px;
            font-weight: 600;
            border: 2px solid var(--primary-gold);
            backdrop-filter: blur(10px);
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        /* Floating Cart Button (always visible) */
        .floating-cart-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--primary-red);
            color: var(--white);
            border: none;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 999;
            box-shadow: var(--shadow-lg);
            transition: var(--transition);
            border: 2px solid var(--primary-gold);
        }
        
        .floating-cart-btn:hover {
            background: var(--secondary-red);
            transform: scale(1.1);
        }
        
        .cart-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--primary-gold);
            color: var(--primary-black);
            font-size: 0.7rem;
            font-weight: 800;
            min-width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid var(--primary-black);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% {
                box-shadow: 0 0 0 0 rgba(212, 175, 55, 0.7);
            }
            50% {
                box-shadow: 0 0 0 6px rgba(212, 175, 55, 0);
            }
        }
        
        /* Franchise Order Form */
        .order-form {
            background: var(--white);
            padding: 2rem;
            border-radius: 10px;
            box-shadow: var(--shadow-md);
            margin-top: 2rem;
            border: 2px solid var(--primary-red);
        }
        
        .form-group {
            margin-bottom: 1.5rem;
            position: relative;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .form-control {
            width: 100%;
            padding: 0.8rem 1rem;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 1rem;
            transition: var(--transition);
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary-red);
            box-shadow: 0 0 0 3px rgba(178, 34, 34, 0.1);
        }
        
        .auto-fill-badge {
            position: absolute;
            top: 0;
            right: 0;
            background: var(--success);
            color: var(--white);
            font-size: 0.7rem;
            padding: 0.2rem 0.6rem;
            border-radius: 0 8px 0 4px;
            font-weight: 600;
            display: none;
        }
        
        .whatsapp-checkout-btn {
            width: 100%;
            background: var(--whatsapp-green);
            color: var(--white);
            border: none;
            padding: 1.2rem;
            border-radius: 0;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.8rem;
            font-size: 1.1rem;
            transition: var(--transition);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-top: 1rem;
        }
        
        .whatsapp-checkout-btn:hover {
            background: var(--whatsapp-dark);
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(37, 211, 102, 0.4);
        }
        
        /* Order Summary */
        .order-summary {
            background: var(--bg-secondary);
            padding: 1.5rem;
            border-radius: 10px;
            margin: 1rem 0;
            border: 1px solid var(--border-color);
        }
        
        .order-summary h3 {
            color: var(--primary-red);
            margin-bottom: 1rem;
            font-size: 1.2rem;
        }
        
        .order-item {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--border-color);
        }
        
        .order-item:last-child {
            border-bottom: none;
        }
        
        .order-total {
            padding-top: 1rem;
            border-top: 2px solid var(--border-color);
            font-weight: bold;
            font-size: 1.2rem;
            color: var(--primary-red);
        }
        
        /* DELIVERY SECTION STYLES */
        .delivery-filters {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            padding: 1rem;
            background: var(--card-bg);
            border-radius: 10px;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
        }
        
        .delivery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.5s ease, transform 0.5s ease;
        }
        
        .delivery-grid.loaded {
            opacity: 1;
            transform: translateY(0);
        }
        
        /* Delivery Assistant Card */
        .delivery-card {
            background: var(--card-bg);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--shadow-sm);
            transition: var(--transition);
            border: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        
        .delivery-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-md);
            border-color: var(--primary-red);
        }
        
        .delivery-card-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
            background: linear-gradient(135deg, var(--primary-black), var(--secondary-black));
            color: var(--white);
            position: relative;
        }
        
        .delivery-card-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-red), var(--primary-gold));
        }
        
        .delivery-status {
            position: absolute;
            top: 1rem;
            right: 1rem;
            padding: 0.4rem 0.8rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .status-available {
            background: var(--success);
            color: var(--white);
        }
        
        .status-busy {
            background: var(--primary-gold);
            color: var(--primary-black);
        }
        
        .status-offline {
            background: var(--gray);
            color: var(--white);
        }
        
        .delivery-name {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--white);
        }
        
        .delivery-id {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-bottom: 0.5rem;
        }
        
        .delivery-vehicle {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }
        
        .delivery-rating {
            display: flex;
            align-items: center;
            gap: 0.3rem;
            color: var(--primary-gold);
            font-size: 0.9rem;
        }
        
        .delivery-card-body {
            padding: 1.5rem;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .delivery-info {
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
        }
        
        .info-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .info-label {
            font-weight: 600;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }
        
        .info-value {
            font-weight: 500;
            color: var(--text-primary);
        }
        
        .delivery-capacity {
            background: var(--bg-secondary);
            padding: 0.8rem;
            border-radius: 8px;
            border-left: 3px solid var(--primary-red);
        }
        
        .capacity-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-bottom: 0.3rem;
        }
        
        .capacity-bar {
            height: 8px;
            background: var(--border-color);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 0.3rem;
        }
        
        .capacity-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-red), var(--primary-gold));
            border-radius: 4px;
            transition: width 0.5s ease;
        }
        
        .capacity-text {
            font-size: 0.75rem;
            color: var(--text-secondary);
            text-align: right;
        }
        
        /* Delivery Buttons */
        .delivery-buttons {
            display: flex;
            gap: 0.8rem;
            margin-top: 1rem;
        }
        
        .pickup-btn {
            flex: 1;
            background: linear-gradient(135deg, var(--primary-red), var(--secondary-red));
            color: var(--white);
            border: none;
            padding: 0.8rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-size: 0.9rem;
        }
        
        .pickup-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        
        .pickup-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .whatsapp-btn {
            width: 45px;
            height: 45px;
            background: var(--whatsapp-green);
            color: var(--white);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
            font-size: 1.2rem;
        }
        
        .whatsapp-btn:hover {
            background: var(--whatsapp-dark);
            transform: scale(1.1);
        }
        
        /* Delivery Loading States */
        .delivery-loading {
            text-align: center;
            padding: 3rem;
            grid-column: 1 / -1;
            display: none;
        }
        
        .delivery-loading.visible {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 300px;
        }
        
        .delivery-error {
            text-align: center;
            padding: 3rem;
            grid-column: 1 / -1;
            display: none;
        }
        
        .delivery-error.visible {
            display: block;
        }
        
        /* Delivery Request Modal */
        .delivery-request-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.95);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2002;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
            padding: 1rem;
        }
        
        .delivery-request-modal.active {
            opacity: 1;
            visibility: visible;
        }
        
        .delivery-modal-content {
            background: var(--white);
            border-radius: 0;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            animation: modalSlideIn 0.3s ease;
            border: 2px solid var(--primary-red);
        }
        
        .delivery-modal-header {
            background: var(--primary-black);
            color: var(--white);
            padding: 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid var(--primary-red);
        }
        
        .delivery-modal-header h2 {
            font-size: 1.5rem;
            color: var(--primary-gold);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .delivery-modal-close {
            background: var(--primary-red);
            color: var(--white);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }
        
        .delivery-modal-close:hover {
            background: var(--secondary-red);
            transform: rotate(90deg);
        }
        
        .delivery-modal-body {
            padding: 2rem;
        }
        
        .assistant-summary {
            background: var(--bg-secondary);
            padding: 1.5rem;
            border-radius: 10px;
            margin-bottom: 2rem;
            border: 1px solid var(--border-color);
        }
        
        .assistant-summary h3 {
            color: var(--primary-red);
            margin-bottom: 1rem;
            font-size: 1.2rem;
        }
        
        .assistant-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
        }
        
        .detail-item {
            display: flex;
            flex-direction: column;
            gap: 0.3rem;
        }
        
        .detail-label {
            font-size: 0.85rem;
            color: var(--text-secondary);
            font-weight: 500;
        }
        
        .detail-value {
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .order-details-textarea {
            width: 100%;
            height: 200px;
            padding: 1rem;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 1rem;
            line-height: 1.6;
            resize: vertical;
            margin-bottom: 1rem;
            transition: var(--transition);
        }
        
        .order-details-textarea:focus {
            outline: none;
            border-color: var(--primary-red);
            box-shadow: 0 0 0 3px rgba(178, 34, 34, 0.1);
        }
        
        .textarea-helper {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-bottom: 1.5rem;
            line-height: 1.5;
        }
        
        .send-delivery-request-btn {
            width: 100%;
            background: var(--whatsapp-green);
            color: var(--white);
            border: none;
            padding: 1.2rem;
            border-radius: 0;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.8rem;
            font-size: 1.1rem;
            transition: var(--transition);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .send-delivery-request-btn:hover {
            background: var(--whatsapp-dark);
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(37, 211, 102, 0.4);
        }
        
        .send-delivery-request-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--primary-black);
            backdrop-filter: blur(20px);
            border-top: 2px solid var(--primary-red);
            z-index: 1000;
            box-shadow: 0 -10px 30px rgba(0,0,0,0.3);
            padding: 0.5rem;
        }
        
        .bottom-nav-container {
            display: flex;
            justify-content: space-around;
            align-items: center;
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-decoration: none;
            color: var(--gray);
            padding: 0.5rem;
            border-radius: 10px;
            transition: var(--transition);
            position: relative;
            min-width: 70px;
            cursor: pointer;
            background: transparent;
            border: none;
        }
        
        .nav-item.active {
            color: var(--white);
            background: linear-gradient(135deg, var(--primary-red) 0%, var(--secondary-red) 100%);
        }
        
        .nav-icon {
            font-size: 1.2rem;
            margin-bottom: 0.3rem;
        }
        
        .nav-label {
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        /* Main Content Overlay when not signed in */
        .content-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 1999;
            display: flex;
            justify-content: center;
            align-items: center;
            color: var(--white);
            text-align: center;
            padding: 2rem;
        }
        
        .content-overlay h2 {
            font-size: 2rem;
            color: var(--primary-gold);
            margin-bottom: 1rem;
        }
        
        .content-overlay p {
            font-size: 1.2rem;
            margin-bottom: 2rem;
            opacity: 0.8;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .hamburger {
                display: flex;
            }
            
            .nav-links {
                display: none;
            }
            
            .user-name {
                display: none;
            }
            
            .products-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 1rem;
            }
            
            .product-image-wrapper {
                height: 280px;
            }
            
            .product-info {
                padding: 1rem;
            }
            
            .product-title {
                font-size: 1rem;
                min-height: 2.8em;
            }
            
            .product-price {
                font-size: 1.3rem;
            }
            
            .modal-body {
                grid-template-columns: 1fr;
                gap: 2rem;
                padding: 2rem;
            }
            
            .modal-image-container {
                height: 300px;
            }
            
            .modal-title {
                font-size: 1.4rem;
            }
            
            .floating-cart-btn {
                bottom: 70px;
                right: 15px;
                width: 50px;
                height: 50px;
            }
            
            .cart-badge {
                min-width: 18px;
                height: 18px;
                font-size: 0.6rem;
            }
            
            /* Delivery Responsive */
            .delivery-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 1rem;
            }
            
            .delivery-card-header {
                padding: 1rem;
            }
            
            .delivery-card-body {
                padding: 1rem;
            }
            
            .assistant-details {
                grid-template-columns: 1fr;
                gap: 0.8rem;
            }
            
            .google-signin-title {
                font-size: 1.5rem;
            }
        }
        
        @media (max-width: 480px) {
            .products-grid {
                grid-template-columns: 1fr;
            }
            
            .product-image-wrapper {
                height: 280px;
            }
            
            .modal-body {
                padding: 1.5rem;
                gap: 1.5rem;
            }
            
            .modal-image-container {
                height: 250px;
            }
            
            .modal-title {
                font-size: 1.3rem;
            }
            
            .modal-price {
                font-size: 1.4rem;
            }
            
            .floating-cart-btn {
                bottom: 60px;
                right: 10px;
                width: 45px;
                height: 45px;
            }
            
            .nav-item {
                min-width: 60px;
                padding: 0.4rem 0.3rem;
            }
            
            .nav-icon {
                font-size: 1rem;
            }
            
            .nav-label {
                font-size: 0.6rem;
            }
            
            /* Delivery Mobile */
            .delivery-grid {
                grid-template-columns: 1fr;
            }
            
            .delivery-buttons {
                flex-direction: column;
            }
            
            .whatsapp-btn {
                width: 100%;
                height: auto;
                padding: 0.8rem;
            }
        }
    </style>
</head>
<body>
    <!-- Google Sign-in Modal -->
    <div class="google-signin-modal" id="googleSigninModal">
        <div class="google-signin-content">
            <div class="google-signin-header">
                <h2><i class="fab fa-google"></i> Sign In Required</h2>
            </div>
            <div class="google-signin-body">
                <div class="google-signin-icon">
                    <i class="fab fa-google"></i>
                </div>
                <h2 class="google-signin-title">Welcome to DSOG Franchise Platform</h2>
                <p class="google-signin-description">
                    To access the franchise ordering system, you must sign in with your Google account. 
                    This ensures secure access and personalized experience.
                </p>
                
                <div class="google-signin-requirements">
                    <h3>Why Google Sign-in?</h3>
                    <ul class="requirements-list">
                        <li>Secure authentication for franchise orders</li>
                        <li>Automatic profile information retrieval</li>
                        <li>Seamless form auto-filling</li>
                        <li>Enhanced security for your orders</li>
                        <li>Quick access across devices</li>
                    </ul>
                </div>
                
                <!-- Google Sign-in Button -->
                <div id="googleSignInButton" class="gsi-container"></div>
                
                <div class="google-signin-note">
                    <i class="fas fa-info-circle"></i> 
                    <strong>Note:</strong> Only authorized franchisees with Google accounts can access this platform. 
                    Your information is used solely for order processing and will not be shared with third parties.
                </div>
            </div>
        </div>
    </div>

    <!-- User Profile Modal -->
    <div class="user-profile-modal" id="userProfileModal">
        <div class="profile-content">
            <div class="profile-header">
                <button class="profile-close" id="profileClose">
                    <i class="fas fa-times"></i>
                </button>
                <div class="profile-avatar" id="profileAvatar">
                    <!-- Avatar will be populated -->
                </div>
                <h3 id="profileName">User Profile</h3>
            </div>
            <div class="profile-body">
                <div class="profile-info" id="profileInfo">
                    <!-- Profile info will be populated -->
                </div>
                <div class="profile-actions">
                    <button class="profile-btn profile-btn-primary" onclick="editUserLocation()">
                        <i class="fas fa-map-marker-alt"></i> Update Location
                    </button>
                    <button class="profile-btn sign-out-btn" onclick="signOut()">
                        <i class="fas fa-sign-out-alt"></i> Sign Out
                    </button>
                    <button class="profile-btn profile-btn-secondary" onclick="closeProfileModal()">
                        <i class="fas fa-times"></i> Close
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- PWA Install Prompt -->
    <div class="pwa-install-prompt" id="pwaInstallPrompt">
        <button class="pwa-install-close" id="pwaInstallClose">
            <i class="fas fa-times"></i>
        </button>
        <div class="pwa-install-header">
            <div class="pwa-install-icon">
                <i class="fas fa-store"></i>
            </div>
            <div>
                <div class="pwa-install-title">Install DSOG Franchise App</div>
                <div class="pwa-install-subtitle">Professional order management on your device</div>
            </div>
        </div>
        <div class="pwa-install-buttons">
            <button class="pwa-install-btn pwa-install-secondary" id="pwaInstallLater">
                Maybe Later
            </button>
            <button class="pwa-install-btn pwa-install-primary" id="pwaInstallNow">
                Install Now
            </button>
        </div>
    </div>

    <!-- Content Overlay (shown when not signed in) -->
    <div class="content-overlay" id="contentOverlay" style="display: none;">
        <div>
            <h2>Sign In Required</h2>
            <p>Please sign in with Google to access the franchise platform</p>
            <div id="overlayGoogleSignIn" class="gsi-container"></div>
        </div>
    </div>

    <!-- Enhanced Header -->
    <header>
        <div class="header-content">
            <img src="https://i.postimg.cc/kMZ1jTww/Untitled-design-4-removebg-preview.png" alt="DSOG Franchise" class="logo">
            
            <!-- User Profile -->
            <div class="user-profile-header" onclick="openProfileModal()" id="userProfileHeader" style="display: none;">
                <div class="user-avatar" id="userAvatar">
                    <!-- Avatar will be populated -->
                </div>
                <span class="user-name" id="userNameDisplay">Guest</span>
            </div>
            
            <!-- Desktop Navigation -->
            <nav class="nav-links">
                <a href="#products" class="active">Products</a>
                <a href="#orders">My Orders</a>
                <a href="#delivery">Delivery Hub</a>
                <a href="#" class="install-app-btn" id="installAppBtn">
                    <i class="fas fa-download"></i>
                    <span>Install App</span>
                </a>
            </nav>
            
            <!-- Hamburger Menu Button -->
            <button class="hamburger" id="hamburgerBtn">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
    </header>

    <!-- Mobile Menu -->
    <div class="mobile-menu" id="mobileMenu">
        <button class="close-menu" id="closeMenu">
            <i class="fas fa-times"></i>
        </button>
        <nav class="mobile-nav-links">
            <a href="#products" onclick="closeMobileMenu()">Products</a>
            <a href="#orders" onclick="closeMobileMenu()">My Orders</a>
            <a href="#delivery" onclick="closeMobileMenu()">Delivery Hub</a>
            <a href="#" onclick="openProfileModal(); closeMobileMenu();">
                <i class="fas fa-user"></i> My Profile
            </a>
            <a href="mailto:care.dsogstores@gmail.com" onclick="closeMobileMenu()">Email Support</a>
            <a href="https://wa.me/254733737983" onclick="closeMobileMenu()">WhatsApp Support</a>
            <a href="#" onclick="showInstallPrompt(); closeMobileMenu();" style="color: var(--primary-gold);">
                <i class="fas fa-download"></i> Install App
            </a>
        </nav>
    </div>
    
    <!-- Menu Backdrop -->
    <div class="menu-backdrop" id="menuBackdrop"></div>

    <!-- Main Content -->
    <main id="mainContent" style="display: none;">
        <!-- Products Section -->
        <section class="products" id="products">
            <div class="section-title">
                <h2>Franchise Products</h2>
                <p>Order products for your franchise location</p>
            </div>
            
            <!-- Product Filters -->
            <div class="product-filters" id="productFilters">
                <button class="filter-btn active" data-filter="all">All Products</button>
                <button class="filter-btn" data-filter="clothing">Clothing</button>
                <button class="filter-btn" data-filter="accessories">Accessories</button>
                <button class="filter-btn" data-filter="home-goods">Home Goods</button>
                <button class="filter-btn" data-filter="new">New Arrivals</button>
            </div>
            
            <!-- Products Grid -->
            <div class="products-grid" id="productsContainer">
                <!-- Enhanced Loading Indicator -->
                <div class="products-loading" id="productsLoading">
                    <div class="loading-spinner-container">
                        <div class="loading-spinner"></div>
                        <div class="loading-logo">DSOG</div>
                    </div>
                    <div class="loading-message">
                        <i class="fas fa-spinner fa-spin"></i>
                        Loading Products...
                    </div>
                    <div class="loading-progress-container">
                        <div class="loading-progress">
                            <div class="loading-progress-bar" id="loadingProgressBar"></div>
                        </div>
                        <div class="loading-count" id="loadingCount">0 products loaded</div>
                    </div>
                </div>
                
                <!-- Error State -->
                <div class="loading-error" id="productsError">
                    <div class="error-content">
                        <i class="fas fa-exclamation-triangle"></i>
                        <h3>Unable to Load Products</h3>
                        <p>There was an error loading the products. Please check your connection and try again.</p>
                        <button class="retry-btn" onclick="retryLoadingProducts()">
                            <i class="fas fa-redo"></i>
                            Retry
                        </button>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Order Form Section -->
        <section class="products" id="orders">
            <div class="section-title">
                <h2>Place Your Order</h2>
                <p>Complete your franchise order below</p>
            </div>
            
            <div class="order-form">
                <div class="form-group">
                    <label for="franchiseeName">Franchisee Name *</label>
                    <input type="text" id="franchiseeName" class="form-control" placeholder="Enter franchisee name" required>
                    <div class="auto-fill-badge" id="nameBadge">Auto-filled</div>
                </div>
                
                <div class="form-group">
                    <label for="franchiseePhone">Phone Number *</label>
                    <input type="tel" id="franchiseePhone" class="form-control" placeholder="Enter phone number" required>
                    <div class="auto-fill-badge" id="phoneBadge">Auto-filled</div>
                </div>
                
                <div class="form-group">
                    <label for="franchiseeLocation">Location/Address *</label>
                    <textarea id="franchiseeLocation" class="form-control" rows="3" placeholder="Enter franchise location address" required></textarea>
                    <div class="auto-fill-badge" id="locationBadge">Auto-filled</div>
                </div>
                
                <div class="form-group">
                    <label for="orderNotes">Order Notes (Optional)</label>
                    <textarea id="orderNotes" class="form-control" rows="2" placeholder="Any special instructions or notes for this order"></textarea>
                </div>
                
                <!-- Order Summary -->
                <div class="order-summary" id="orderSummary">
                    <h3>Order Summary</h3>
                    <div id="orderItems">
                        <!-- Order items will be populated here -->
                    </div>
                    <div class="order-total">
                        <span>Total:</span>
                        <span id="orderTotal">KSh 0</span>
                    </div>
                </div>
                
                <button class="whatsapp-checkout-btn" id="whatsappCheckoutBtn" onclick="submitFranchiseOrder()">
                    <i class="fab fa-whatsapp"></i> Submit Order via WhatsApp
                </button>
            </div>
        </section>
        
        <!-- Delivery Assistant Section -->
        <section class="products" id="delivery">
            <div class="section-title">
                <h2>Delivery Assistants Hub</h2>
                <p>Request delivery assistance for your franchise orders</p>
            </div>
            
            <!-- Delivery Filters -->
            <div class="delivery-filters" id="deliveryFilters">
                <button class="filter-btn active" data-filter="all">All Assistants</button>
                <button class="filter-btn" data-filter="available">Available Now</button>
                <button class="filter-btn" data-filter="busy">On Delivery</button>
            </div>
            
            <!-- Delivery Assistants Grid -->
            <div class="delivery-grid" id="deliveryContainer">
                <!-- Loading State -->
                <div class="delivery-loading" id="deliveryLoading">
                    <div class="loading-spinner-container">
                        <div class="loading-spinner"></div>
                        <div class="loading-logo">DSOG</div>
                    </div>
                    <div class="loading-message">
                        <i class="fas fa-spinner fa-spin"></i>
                        Loading Delivery Assistants...
                    </div>
                </div>
                
                <!-- Error State -->
                <div class="delivery-error" id="deliveryError">
                    <div class="error-content">
                        <i class="fas fa-exclamation-triangle"></i>
                        <h3>Unable to Load Delivery Assistants</h3>
                        <p>There was an error loading delivery assistants. Please check your connection and try again.</p>
                        <button class="retry-btn" onclick="retryLoadingDeliveryAssistants()">
                            <i class="fas fa-redo"></i>
                            Retry
                        </button>
                    </div>
                </div>
                
                <!-- Delivery assistants will be loaded here -->
            </div>
        </section>
    </main>

    <!-- Product Modal -->
    <div class="product-modal" id="productModal">
        <div class="modal-content">
            <button class="modal-close" id="modalClose">
                <i class="fas fa-times"></i>
            </button>
            <div class="modal-body" id="modalBody">
                <!-- Modal content will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Cart Modal -->
    <div class="cart-modal" id="cartModal">
        <div class="cart-modal-content">
            <div class="cart-header">
                <h2><i class="fas fa-shopping-cart"></i> Your Cart</h2>
                <button class="cart-close" id="cartClose">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="cart-body" id="cartBody">
                <!-- Cart items will be populated by JavaScript -->
            </div>
            <div class="cart-footer">
                <button class="checkout-btn" id="checkoutBtn" onclick="openOrderSummary()">
                    <i class="fas fa-credit-card"></i> Proceed to Order Summary
                </button>
            </div>
        </div>
    </div>

    <!-- Delivery Request Modal -->
    <div class="delivery-request-modal" id="deliveryRequestModal">
        <div class="delivery-modal-content">
            <div class="delivery-modal-header">
                <h2><i class="fas fa-truck"></i> Request Delivery Assistant</h2>
                <button class="delivery-modal-close" id="deliveryModalClose">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="delivery-modal-body" id="deliveryModalBody">
                <!-- Delivery modal content will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Floating Cart Button -->
    <button class="floating-cart-btn" id="floatingCartBtn" onclick="openCartModal()" style="display: none;">
        <i class="fas fa-shopping-cart"></i>
        <span class="cart-badge" id="cartBadge">0</span>
    </button>

    <!-- Bottom Navigation -->
    <nav class="bottom-nav" style="display: none;">
        <div class="bottom-nav-container">
            <button class="nav-item active" onclick="scrollToSection('products')">
                <i class="fas fa-box nav-icon"></i>
                <span class="nav-label">Products</span>
            </button>
            <button class="nav-item" onclick="scrollToSection('orders')">
                <i class="fas fa-file-invoice nav-icon"></i>
                <span class="nav-label">Orders</span>
            </button>
            <button class="nav-item" onclick="scrollToSection('delivery')">
                <i class="fas fa-truck nav-icon"></i>
                <span class="nav-label">Delivery</span>
            </button>
            <button class="nav-item" onclick="openCartModal()">
                <i class="fas fa-shopping-cart nav-icon"></i>
                <span class="nav-label">Cart</span>
            </button>
            <button class="nav-item" onclick="openProfileModal()">
                <i class="fas fa-user nav-icon"></i>
                <span class="nav-label">Profile</span>
            </button>
        </div>
    </nav>

    <!-- JavaScript -->
    <script>
    // Configuration
    const scriptUrl = 'https://script.google.com/macros/s/AKfycbwpY5zDbfzFMYfgWCDY0dLRaCh_sajs_Pd3tT8lto5S_BA6UICTfjn8dkFuBq7Gx0-d/exec';
    const deliveryScriptUrl = 'https://script.google.com/macros/s/AKfycbzmBoCu_jXpp8oKpNAnX7Ly-bqvfdfhgiHge74ZW0oYae0wUlZERDERJYB-ZC76J9kQYQ/exec';
    const GOOGLE_CLIENT_ID = '369304497158-8ub6b68v2bjvsfciome6q56flh2rd1m4.apps.googleusercontent.com';
    
    // State management
    let cart = JSON.parse(localStorage.getItem('dsog_franchise_cart')) || [];
    let allProducts = [];
    let currentFilter = 'all';
    let isLoadingProducts = false;
    
    // Delivery State Management
    let deliveryAssistants = [];
    let currentDeliveryFilter = 'all';
    let selectedAssistant = null;
    let isLoadingDelivery = false;
    
    // User Profile State
    let userProfile = JSON.parse(localStorage.getItem('dsog_franchise_profile')) || null;
    let googleUser = null;
    let googleToken = null;
    
    // PWA variables
    let deferredPrompt = null;
    let isAppInstalled = false;
    let isInstallPromptShown = false;
    
    // Initialize the page
    document.addEventListener('DOMContentLoaded', function() {
        console.log('ðŸš€ DSOG Franchise Platform v2.6.0');
        
        // Initialize components
        initMobileMenu();
        initProductFilters();
        initModal();
        initCartModal();
        initDeliverySection();
        initPWA();
        initProfileModal();
        
        // Check for existing Google Sign-in
        checkGoogleSignIn();
        
        // Initialize Google Sign-in
        initializeGoogleSignIn();
    });
    
    // Google Sign-in Functions
    function initializeGoogleSignIn() {
        // Check if Google SDK is loaded
        if (typeof google === 'undefined') {
            console.error('Google Sign-in SDK not loaded');
            setTimeout(initializeGoogleSignIn, 1000);
            return;
        }
        
        // Initialize Google Sign-in
        google.accounts.id.initialize({
            client_id: GOOGLE_CLIENT_ID,
            callback: handleGoogleSignIn,
            auto_select: false,
            cancel_on_tap_outside: true,
            context: 'signin',
            ux_mode: 'popup',
            login_uri: window.location.origin,
            prompt_parent_id: 'googleSignInButton'
        });
        
        // Also initialize for overlay button
        google.accounts.id.initialize({
            client_id: GOOGLE_CLIENT_ID,
            callback: handleGoogleSignIn,
            auto_select: false,
            cancel_on_tap_outside: true,
            context: 'signin',
            ux_mode: 'popup'
        });
        
        // Render the button
        google.accounts.id.renderButton(
            document.getElementById('googleSignInButton'),
            {
                type: 'standard',
                theme: 'filled_blue',
                size: 'large',
                text: 'signin_with',
                shape: 'rectangular',
                logo_alignment: 'left',
                width: 250
            }
        );
        
        // Also render button for overlay
        google.accounts.id.renderButton(
            document.getElementById('overlayGoogleSignIn'),
            {
                type: 'standard',
                theme: 'filled_blue',
                size: 'large',
                text: 'signin_with',
                shape: 'rectangular',
                logo_alignment: 'left',
                width: 250
            }
        );
        
        // Show sign-in modal if user is not signed in
        if (!userProfile || !userProfile.googleId) {
            setTimeout(() => {
                showGoogleSignInModal();
            }, 1000);
        }
    }
    
    function checkGoogleSignIn() {
        // Check if user is already signed in via localStorage
        if (userProfile && userProfile.googleId) {
            // User is signed in, show content
            showMainContent();
            
            // Update UI
            updateUserProfileUI();
            
            // Auto-fill order form
            autoFillOrderForm();
            
            // Load products
            showProductLoading();
            setTimeout(() => {
                loadProducts();
            }, 500);
            
            // Update cart badge
            updateCartBadge();
            
            // Set up navigation
            setupNavigation();
            
            // Load delivery assistants after products
            setTimeout(() => {
                loadDeliveryAssistants();
            }, 1000);
            
            return true;
        }
        
        return false;
    }
    
    function handleGoogleSignIn(response) {
        console.log('Google Sign-in response received');
        
        // Decode the JWT token
        const responsePayload = decodeJWTResponse(response.credential);
        
        if (responsePayload) {
            // Save user data
            googleUser = responsePayload;
            googleToken = response.credential;
            
            // Create or update user profile
            userProfile = {
                googleId: googleUser.sub,
                email: googleUser.email,
                name: googleUser.name,
                givenName: googleUser.given_name,
                familyName: googleUser.family_name,
                picture: googleUser.picture,
                emailVerified: googleUser.email_verified,
                phone: '', // Google doesn't provide phone by default
                location: '', // Will be asked separately
                locationUpdated: false,
                createdAt: new Date().toISOString(),
                lastLogin: new Date().toISOString()
            };
            
            // Save to localStorage
            localStorage.setItem('dsog_franchise_profile', JSON.stringify(userProfile));
            
            // Hide sign-in modal
            hideGoogleSignInModal();
            
            // Show success notification
            showNotification(`Welcome ${googleUser.name}!`);
            
            // Update UI
            updateUserProfileUI();
            
            // Show main content
            showMainContent();
            
            // Auto-fill order form
            autoFillOrderForm();
            
            // Load products
            showProductLoading();
            setTimeout(() => {
                loadProducts();
            }, 500);
            
            // Update cart badge
            updateCartBadge();
            
            // Set up navigation
            setupNavigation();
            
            // Load delivery assistants after products
            setTimeout(() => {
                loadDeliveryAssistants();
            }, 1000);
            
            // Ask for location if not already set
            if (!userProfile.location || !userProfile.locationUpdated) {
                setTimeout(() => {
                    askForLocation();
                }, 2000);
            }
        } else {
            console.error('Failed to decode Google Sign-in response');
            showNotification('Failed to sign in with Google. Please try again.', 'error');
        }
    }
    
    function decodeJWTResponse(token) {
        try {
            const base64Url = token.split('.')[1];
            const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
            const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
                return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
            }).join(''));
            
            return JSON.parse(jsonPayload);
        } catch (error) {
            console.error('Error decoding JWT:', error);
            return null;
        }
    }
    
    function showGoogleSignInModal() {
        const signinModal = document.getElementById('googleSigninModal');
        const overlay = document.getElementById('contentOverlay');
        
        signinModal.classList.add('active');
        overlay.style.display = 'flex';
        document.body.style.overflow = 'hidden';
    }
    
    function hideGoogleSignInModal() {
        const signinModal = document.getElementById('googleSigninModal');
        const overlay = document.getElementById('contentOverlay');
        const mainContent = document.getElementById('mainContent');
        
        signinModal.classList.remove('active');
        overlay.style.display = 'none';
        mainContent.style.display = 'block';
        document.body.style.overflow = 'auto';
    }
    
    function showMainContent() {
        const overlay = document.getElementById('contentOverlay');
        const mainContent = document.getElementById('mainContent');
        const floatingCartBtn = document.getElementById('floatingCartBtn');
        const bottomNav = document.querySelector('.bottom-nav');
        const userProfileHeader = document.getElementById('userProfileHeader');
        
        overlay.style.display = 'none';
        mainContent.style.display = 'block';
        floatingCartBtn.style.display = 'flex';
        bottomNav.style.display = 'block';
        userProfileHeader.style.display = 'flex';
    }
    
    function askForLocation() {
        if (!userProfile || !userProfile.googleId) return;
        
        const location = prompt(
            'Please enter your franchise location/address:\n\nThis will be used to auto-fill your orders and delivery requests.',
            userProfile.location || ''
        );
        
        if (location !== null) {
            userProfile.location = location.trim();
            userProfile.locationUpdated = true;
            localStorage.setItem('dsog_franchise_profile', JSON.stringify(userProfile));
            
            // Update form
            autoFillOrderForm();
            
            showNotification('Location saved successfully!');
        }
    }
    
    function editUserLocation() {
        if (!userProfile || !userProfile.googleId) return;
        
        const location = prompt(
            'Update your franchise location/address:',
            userProfile.location || ''
        );
        
        if (location !== null) {
            userProfile.location = location.trim();
            userProfile.locationUpdated = true;
            localStorage.setItem('dsog_franchise_profile', JSON.stringify(userProfile));
            
            // Update form and UI
            autoFillOrderForm();
            updateUserProfileUI();
            
            showNotification('Location updated successfully!');
        }
        
        closeProfileModal();
    }
    
    function signOut() {
        if (confirm('Are you sure you want to sign out?')) {
            // Clear user data
            userProfile = null;
            googleUser = null;
            googleToken = null;
            localStorage.removeItem('dsog_franchise_profile');
            
            // Clear cart
            cart = [];
            localStorage.removeItem('dsog_franchise_cart');
            
            // Hide content
            const mainContent = document.getElementById('mainContent');
            const floatingCartBtn = document.getElementById('floatingCartBtn');
            const bottomNav = document.querySelector('.bottom-nav');
            const userProfileHeader = document.getElementById('userProfileHeader');
            
            mainContent.style.display = 'none';
            floatingCartBtn.style.display = 'none';
            bottomNav.style.display = 'none';
            userProfileHeader.style.display = 'none';
            
            // Show sign-in modal
            showGoogleSignInModal();
            
            // Update cart badge
            updateCartBadge();
            
            showNotification('Signed out successfully');
        }
    }
    
    function updateUserProfileUI() {
        if (userProfile) {
            // Update header
            const userAvatar = document.getElementById('userAvatar');
            const userNameDisplay = document.getElementById('userNameDisplay');
            const profileAvatar = document.getElementById('profileAvatar');
            const profileName = document.getElementById('profileName');
            const profileInfo = document.getElementById('profileInfo');
            
            // Set avatar image or initials
            if (userProfile.picture) {
                if (userAvatar) {
                    userAvatar.innerHTML = `<img src="${userProfile.picture}" alt="${userProfile.name}">`;
                }
                if (profileAvatar) {
                    profileAvatar.innerHTML = `<img src="${userProfile.picture}" alt="${userProfile.name}">`;
                }
            } else {
                // Get initials for avatar
                const initials = userProfile.name.split(' ').map(n => n[0]).join('').toUpperCase().substring(0, 2);
                
                if (userAvatar) {
                    userAvatar.textContent = initials;
                    userAvatar.style.background = 'linear-gradient(135deg, var(--primary-red), var(--primary-gold))';
                }
                
                if (profileAvatar) {
                    profileAvatar.textContent = initials;
                    profileAvatar.style.background = 'linear-gradient(135deg, var(--primary-red), var(--primary-gold))';
                }
            }
            
            if (userNameDisplay) {
                userNameDisplay.textContent = userProfile.givenName || userProfile.name.split(' ')[0];
            }
            
            if (profileName) {
                profileName.textContent = userProfile.name;
            }
            
            if (profileInfo) {
                profileInfo.innerHTML = `
                    <div class="info-item">
                        <span class="info-label">Full Name:</span>
                        <span class="info-value">${userProfile.name}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Email:</span>
                        <span class="info-value">${userProfile.email}</span>
                    </div>
                    ${userProfile.phone ? `
                    <div class="info-item">
                        <span class="info-label">Phone:</span>
                        <span class="info-value">${userProfile.phone}</span>
                    </div>
                    ` : ''}
                    <div class="info-item">
                        <span class="info-label">Location:</span>
                        <span class="info-value">${userProfile.location || 'Not set'}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Account Created:</span>
                        <span class="info-value">${new Date(userProfile.createdAt).toLocaleDateString()}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Last Login:</span>
                        <span class="info-value">${new Date(userProfile.lastLogin).toLocaleDateString()}</span>
                    </div>
                `;
            }
        }
    }
    
    function autoFillOrderForm() {
        if (userProfile) {
            const nameField = document.getElementById('franchiseeName');
            const phoneField = document.getElementById('franchiseePhone');
            const locationField = document.getElementById('franchiseeLocation');
            
            if (nameField && userProfile.name) {
                nameField.value = userProfile.name;
                showAutoFillBadge('nameBadge');
            }
            
            if (phoneField && userProfile.phone) {
                phoneField.value = userProfile.phone;
                showAutoFillBadge('phoneBadge');
            }
            
            if (locationField && userProfile.location) {
                locationField.value = userProfile.location;
                showAutoFillBadge('locationBadge');
            }
        }
    }
    
    function showAutoFillBadge(badgeId) {
        const badge = document.getElementById(badgeId);
        if (badge) {
            badge.style.display = 'block';
            setTimeout(() => {
                badge.style.display = 'none';
            }, 3000);
        }
    }
    
    function initProfileModal() {
        const profileModal = document.getElementById('userProfileModal');
        const profileClose = document.getElementById('profileClose');
        
        profileClose.addEventListener('click', closeProfileModal);
        
        profileModal.addEventListener('click', function(e) {
            if (e.target === profileModal) {
                closeProfileModal();
            }
        });
        
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && profileModal.classList.contains('active')) {
                closeProfileModal();
            }
        });
    }
    
    function openProfileModal() {
        if (!userProfile || !userProfile.googleId) {
            showNotification('Please sign in first', 'error');
            return;
        }
        
        const profileModal = document.getElementById('userProfileModal');
        
        // Update profile info before showing
        updateUserProfileUI();
        
        profileModal.classList.add('active');
        document.body.style.overflow = 'hidden';
    }
    
    function closeProfileModal() {
        const profileModal = document.getElementById('userProfileModal');
        profileModal.classList.remove('active');
        document.body.style.overflow = 'auto';
    }
    
    // Initialize Mobile Menu
    function initMobileMenu() {
        const hamburgerBtn = document.getElementById('hamburgerBtn');
        const mobileMenu = document.getElementById('mobileMenu');
        const menuBackdrop = document.getElementById('menuBackdrop');
        const closeMenu = document.getElementById('closeMenu');
        
        function toggleMobileMenu() {
            const isOpen = mobileMenu.classList.contains('active');
            
            if (!isOpen) {
                mobileMenu.classList.add('active');
                menuBackdrop.classList.add('active');
                hamburgerBtn.classList.add('active');
                document.body.style.overflow = 'hidden';
            } else {
                mobileMenu.classList.remove('active');
                menuBackdrop.classList.remove('active');
                hamburgerBtn.classList.remove('active');
                document.body.style.overflow = 'auto';
            }
        }
        
        hamburgerBtn.addEventListener('click', toggleMobileMenu);
        closeMenu.addEventListener('click', toggleMobileMenu);
        menuBackdrop.addEventListener('click', toggleMobileMenu);
        
        const mobileLinks = document.querySelectorAll('.mobile-nav-links a');
        mobileLinks.forEach(link => {
            link.addEventListener('click', toggleMobileMenu);
        });
    }
    
    window.closeMobileMenu = function() {
        const mobileMenu = document.getElementById('mobileMenu');
        const menuBackdrop = document.getElementById('menuBackdrop');
        const hamburgerBtn = document.getElementById('hamburgerBtn');
        
        mobileMenu.classList.remove('active');
        menuBackdrop.classList.remove('active');
        hamburgerBtn.classList.remove('active');
        document.body.style.overflow = 'auto';
    };
    
    // Setup Navigation
    function setupNavigation() {
        const navItems = document.querySelectorAll('.nav-item');
        
        navItems.forEach(item => {
            item.addEventListener('click', function() {
                // Remove active class from all items
                navItems.forEach(i => i.classList.remove('active'));
                // Add active class to clicked item
                this.classList.add('active');
            });
        });
        
        // Handle scroll to section
        window.scrollToSection = function(sectionId) {
            const element = document.getElementById(sectionId);
            if (element) {
                element.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            }
        };
    }
    
    // Initialize Product Filters
    function initProductFilters() {
        const filterButtons = document.querySelectorAll('#productFilters .filter-btn');
        
        filterButtons.forEach(button => {
            button.addEventListener('click', function() {
                filterButtons.forEach(btn => btn.classList.remove('active'));
                this.classList.add('active');
                
                currentFilter = this.dataset.filter;
                filterProducts();
            });
        });
    }
    
    // Initialize Delivery Section
    function initDeliverySection() {
        initDeliveryFilters();
        initDeliveryModal();
    }
    
    // Initialize Delivery Filters
    function initDeliveryFilters() {
        const filterButtons = document.querySelectorAll('#deliveryFilters .filter-btn');
        
        filterButtons.forEach(button => {
            button.addEventListener('click', function() {
                filterButtons.forEach(btn => btn.classList.remove('active'));
                this.classList.add('active');
                
                currentDeliveryFilter = this.dataset.filter;
                filterDeliveryAssistants();
            });
        });
    }
    
    // Initialize Delivery Modal
    function initDeliveryModal() {
        const deliveryModal = document.getElementById('deliveryRequestModal');
        const deliveryModalClose = document.getElementById('deliveryModalClose');
        
        deliveryModalClose.addEventListener('click', closeDeliveryModal);
        
        deliveryModal.addEventListener('click', function(e) {
            if (e.target === deliveryModal) {
                closeDeliveryModal();
            }
        });
        
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && deliveryModal.classList.contains('active')) {
                closeDeliveryModal();
            }
        });
    }
    
    // Initialize Modals
    function initModal() {
        const productModal = document.getElementById('productModal');
        const modalClose = document.getElementById('modalClose');
        
        modalClose.addEventListener('click', closeModal);
        
        productModal.addEventListener('click', function(e) {
            if (e.target === productModal) {
                closeModal();
            }
        });
        
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && productModal.classList.contains('active')) {
                closeModal();
            }
        });
    }
    
    function initCartModal() {
        const cartModal = document.getElementById('cartModal');
        const cartClose = document.getElementById('cartClose');
        const floatingCartBtn = document.getElementById('floatingCartBtn');
        
        cartClose.addEventListener('click', closeCartModal);
        floatingCartBtn.addEventListener('click', openCartModal);
        
        cartModal.addEventListener('click', function(e) {
            if (e.target === cartModal) {
                closeCartModal();
            }
        });
        
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && cartModal.classList.contains('active')) {
                closeCartModal();
            }
        });
    }
    
    // Cart Management Functions
    function updateCartBadge() {
        const cartBadge = document.getElementById('cartBadge');
        const totalItems = cart.reduce((total, item) => total + item.quantity, 0);
        cartBadge.textContent = totalItems > 9 ? '9+' : totalItems;
        
        if (totalItems > 0) {
            cartBadge.style.display = 'flex';
        } else {
            cartBadge.style.display = 'none';
        }
        
        // Update order summary
        updateOrderSummary();
    }
    
    function addToCart(product, buttonElement = null) {
        try {
            const cartProduct = {
                id: product.id || 'prod_' + Date.now() + Math.random().toString(36).substr(2, 9),
                name: product.name || 'Unnamed Product',
                price: product.basePrice || product.price || 0,
                image: product.image || product.images?.[0] || 'https://images.unsplash.com/photo-1556742049-0cfed4f6a45d?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80',
                quantity: 1,
                category: product.category || product.collectionName || 'General'
            };
            
            const existingItemIndex = cart.findIndex(item => item.id === cartProduct.id);
            
            if (existingItemIndex > -1) {
                cart[existingItemIndex].quantity += 1;
            } else {
                cart.push(cartProduct);
            }
            
            localStorage.setItem('dsog_franchise_cart', JSON.stringify(cart));
            updateCartBadge();
            
            if (buttonElement) {
                const originalText = buttonElement.innerHTML;
                buttonElement.classList.add('added');
                buttonElement.innerHTML = '<i class="fas fa-check"></i> Added to Cart';
                
                setTimeout(() => {
                    buttonElement.classList.remove('added');
                    buttonElement.innerHTML = originalText;
                }, 2000);
            }
            
            showNotification(`Added ${cartProduct.name} to cart!`);
            
        } catch (error) {
            console.error('Error adding to cart:', error);
            showNotification('Failed to add item to cart');
        }
    }
    
    function removeFromCart(productId) {
        cart = cart.filter(item => item.id !== productId);
        localStorage.setItem('dsog_franchise_cart', JSON.stringify(cart));
        updateCartBadge();
        renderCart();
        showNotification('Item removed from cart');
    }
    
    function updateQuantity(productId, newQuantity) {
        const itemIndex = cart.findIndex(item => item.id === productId);
        if (itemIndex > -1) {
            if (newQuantity < 1) {
                removeFromCart(productId);
            } else {
                cart[itemIndex].quantity = newQuantity;
                localStorage.setItem('dsog_franchise_cart', JSON.stringify(cart));
                renderCart();
                updateCartBadge();
            }
        }
    }
    
    function renderCart() {
        const cartBody = document.getElementById('cartBody');
        const checkoutBtn = document.getElementById('checkoutBtn');
        
        if (cart.length === 0) {
            cartBody.innerHTML = `
                <div class="cart-empty">
                    <i class="fas fa-shopping-cart"></i>
                    <p>Your cart is empty</p>
                    <button onclick="closeCartModal()" style="padding: 0.8rem 2rem; background: var(--primary-red); color: white; border: none; border-radius: 30px; cursor: pointer; font-weight: 600; transition: var(--transition);">
                        Continue Shopping
                    </button>
                </div>
            `;
            checkoutBtn.disabled = true;
            return;
        }
        
        let cartHTML = `
            <div class="cart-items">
        `;
        
        cart.forEach(item => {
            cartHTML += `
                <div class="cart-item" data-id="${item.id}">
                    <div class="cart-item-image">
                        <img src="${item.image}" alt="${item.name}" loading="lazy">
                    </div>
                    <div class="cart-item-details">
                        <div class="cart-item-title">${item.name}</div>
                        <div class="cart-item-price">KSh ${item.price * item.quantity}</div>
                    </div>
                    <div class="cart-item-controls">
                        <div class="quantity-control">
                            <button class="quantity-btn" onclick="updateQuantity('${item.id}', ${item.quantity - 1})">-</button>
                            <span class="quantity-value">${item.quantity}</span>
                            <button class="quantity-btn" onclick="updateQuantity('${item.id}', ${item.quantity + 1})">+</button>
                        </div>
                        <button class="remove-item-btn" onclick="removeFromCart('${item.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `;
        });
        
        const totals = calculateCartTotal();
        
        cartHTML += `
            </div>
            <div class="cart-summary">
                <div class="summary-row">
                    <span>Subtotal</span>
                    <span>KSh ${totals.subtotal}</span>
                </div>
                <div class="summary-row">
                    <span>Items</span>
                    <span>${cart.reduce((total, item) => total + item.quantity, 0)}</span>
                </div>
                <div class="summary-row">
                    <span>Total</span>
                    <span>KSh ${totals.total}</span>
                </div>
            </div>
        `;
        
        cartBody.innerHTML = cartHTML;
        checkoutBtn.disabled = false;
    }
    
    function calculateCartTotal() {
        const subtotal = cart.reduce((total, item) => total + (item.price * item.quantity), 0);
        return {
            subtotal,
            total: subtotal
        };
    }
    
    function updateOrderSummary() {
        const orderItems = document.getElementById('orderItems');
        const orderTotal = document.getElementById('orderTotal');
        
        if (cart.length === 0) {
            orderItems.innerHTML = '<p style="color: var(--gray); text-align: center;">No items in cart</p>';
            orderTotal.textContent = 'KSh 0';
            return;
        }
        
        let itemsHTML = '';
        let total = 0;
        
        cart.forEach((item, index) => {
            const itemTotal = item.price * item.quantity;
            total += itemTotal;
            
            itemsHTML += `
                <div class="order-item">
                    <span>${item.quantity}x ${item.name}</span>
                    <span>KSh ${itemTotal}</span>
                </div>
            `;
        });
        
        orderItems.innerHTML = itemsHTML;
        orderTotal.textContent = `KSh ${total}`;
    }
    
    function openCartModal() {
        if (!userProfile || !userProfile.googleId) {
            showNotification('Please sign in first', 'error');
            return;
        }
        
        const cartModal = document.getElementById('cartModal');
        renderCart();
        cartModal.classList.add('active');
        document.body.style.overflow = 'hidden';
    }
    
    function closeCartModal() {
        const cartModal = document.getElementById('cartModal');
        cartModal.classList.remove('active');
        document.body.style.overflow = 'auto';
    }
    
    function openOrderSummary() {
        closeCartModal();
        setTimeout(() => {
            scrollToSection('orders');
        }, 300);
    }
    
    function openModal() {
        const productModal = document.getElementById('productModal');
        productModal.classList.add('active');
        document.body.style.overflow = 'hidden';
    }
    
    function closeModal() {
        const productModal = document.getElementById('productModal');
        productModal.classList.remove('active');
        document.body.style.overflow = 'auto';
    }
    
    // Delivery Modal Functions
    function openDeliveryModal(assistant) {
        if (!userProfile || !userProfile.googleId) {
            showNotification('Please sign in first', 'error');
            return;
        }
        
        selectedAssistant = assistant;
        const deliveryModal = document.getElementById('deliveryRequestModal');
        const deliveryModalBody = document.getElementById('deliveryModalBody');
        
        // Auto-fill with user profile data
        const franchiseeName = userProfile ? userProfile.name : '';
        const franchiseePhone = userProfile ? userProfile.phone : '';
        const franchiseeLocation = userProfile ? userProfile.location : '';
        
        let orderDetails = `Order Details:\n\n`;
        orderDetails += `Franchisee: ${franchiseeName}\n`;
        orderDetails += `Phone: ${franchiseePhone || 'Not provided'}\n`;
        orderDetails += `Location: ${franchiseeLocation || 'Not set'}\n\n`;
        
        if (cart.length > 0) {
            orderDetails += `Items:\n`;
            cart.forEach((item, index) => {
                orderDetails += `${index + 1}. ${item.quantity}x ${item.name} - KSh ${item.price * item.quantity}\n`;
            });
            orderDetails += `\n`;
        }
        
        orderDetails += `Additional Instructions:\n`;
        
        deliveryModalBody.innerHTML = `
            <div class="assistant-summary">
                <h3>Delivery Assistant Details</h3>
                <div class="assistant-details">
                    <div class="detail-item">
                        <span class="detail-label">Assistant Name:</span>
                        <span class="detail-value">${assistant.name}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Assistant ID:</span>
                        <span class="detail-value">${assistant.id}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Phone:</span>
                        <span class="detail-value">${assistant.phone}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Vehicle:</span>
                        <span class="detail-value">${assistant.vehicle}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Status:</span>
                        <span class="detail-value"><span class="delivery-status status-${assistant.status}">${assistant.status}</span></span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Current Capacity:</span>
                        <span class="detail-value">${assistant.currentCapacity}/${assistant.maxCapacity}</span>
                    </div>
                </div>
            </div>
            
            <div class="form-group">
                <label for="orderDetails">Paste Your Order Details *</label>
                <textarea 
                    id="orderDetails" 
                    class="order-details-textarea" 
                    placeholder="Paste your order details here including:\nâ€¢ Order ID\nâ€¢ Items list\nâ€¢ Delivery address\nâ€¢ Pickup location\nâ€¢ Special instructions\n\nYou can copy from your previous order summary or type manually." 
                    required>${orderDetails}</textarea>
                <p class="textarea-helper">
                    <i class="fas fa-info-circle"></i> Your profile information has been pre-filled. Please add any additional details for the delivery assistant.
                </p>
            </div>
            
            <button class="send-delivery-request-btn" onclick="sendDeliveryRequest()">
                <i class="fab fa-whatsapp"></i> Send Pickup Request via WhatsApp
            </button>
        `;
        
        deliveryModal.classList.add('active');
        document.body.style.overflow = 'hidden';
    }
    
    function closeDeliveryModal() {
        const deliveryModal = document.getElementById('deliveryRequestModal');
        deliveryModal.classList.remove('active');
        document.body.style.overflow = 'auto';
        selectedAssistant = null;
    }
    
    async function sendDeliveryRequest() {
        if (!userProfile || !userProfile.googleId) {
            showNotification('Please sign in first', 'error');
            return;
        }
        
        const orderDetails = document.getElementById('orderDetails').value.trim();
        
        if (!orderDetails) {
            showNotification('Please paste your order details', 'error');
            return;
        }
        
        if (!selectedAssistant) {
            showNotification('No delivery assistant selected', 'error');
            return;
        }
        
        try {
            // Get franchisee info from user profile
            const franchiseeName = userProfile.name;
            const franchiseePhone = userProfile.phone || document.getElementById('franchiseePhone').value.trim();
            const franchiseeLocation = userProfile.location || document.getElementById('franchiseeLocation').value.trim();
            
            // Generate order ID
            const orderId = 'FR-' + Date.now().toString().slice(-8);
            
            // Build WhatsApp message
            let whatsappMessage = `*DELIVERY PICKUP REQUEST - DSOG FRANCHISE*%0A%0A`;
            whatsappMessage += `*Request ID:* ${orderId}%0A`;
            whatsappMessage += `*Date:* ${new Date().toLocaleDateString()}%0A`;
            whatsappMessage += `*Time:* ${new Date().toLocaleTimeString()}%0A%0A`;
            
            whatsappMessage += `*FRANCHISEE INFORMATION*%0A`;
            whatsappMessage += `Name: ${franchiseeName}%0A`;
            whatsappMessage += `Phone: ${franchiseePhone}%0A`;
            whatsappMessage += `Location: ${franchiseeLocation}%0A%0A`;
            
            whatsappMessage += `*ASSIGNED DELIVERY ASSISTANT*%0A`;
            whatsappMessage += `Name: ${selectedAssistant.name}%0A`;
            whatsappMessage += `ID: ${selectedAssistant.id}%0A`;
            whatsappMessage += `Phone: ${selectedAssistant.phone}%0A`;
            whatsappMessage += `Vehicle: ${selectedAssistant.vehicle}%0A%0A`;
            
            whatsappMessage += `*ORDER DETAILS*%0A`;
            whatsappMessage += `${orderDetails.replace(/\n/g, '%0A')}%0A%0A`;
            
            whatsappMessage += `_This pickup request was sent via DSOG Franchise Platform_%0A`;
            whatsappMessage += `_Please acknowledge receipt and provide ETA_`;
            
            // Clean phone number for WhatsApp
            const assistantPhone = selectedAssistant.phone.replace(/\D/g, '');
            if (!assistantPhone.startsWith('254')) {
                // If it's not in Kenyan format, assume it's missing country code
                const cleanedPhone = assistantPhone.startsWith('0') ? '254' + assistantPhone.substring(1) : '254' + assistantPhone;
                const whatsappUrl = `https://wa.me/${cleanedPhone}?text=${whatsappMessage}`;
                window.open(whatsappUrl, '_blank');
            } else {
                const whatsappUrl = `https://wa.me/${assistantPhone}?text=${whatsappMessage}`;
                window.open(whatsappUrl, '_blank');
            }
            
            // Also send copy to support
            const supportMessage = `*NEW DELIVERY REQUEST - ${selectedAssistant.name}*%0A%0A${whatsappMessage}`;
            const supportWhatsappUrl = `https://wa.me/254733737983?text=${supportMessage}`;
            window.open(supportWhatsappUrl, '_blank');
            
            // Show success notification
            showNotification('Pickup request sent to delivery assistant!');
            
            // Close modal
            closeDeliveryModal();
            
            // Update assistant status locally
            const assistantIndex = deliveryAssistants.findIndex(a => a.id === selectedAssistant.id);
            if (assistantIndex > -1) {
                deliveryAssistants[assistantIndex].status = 'busy';
                deliveryAssistants[assistantIndex].currentCapacity = Math.min(
                    deliveryAssistants[assistantIndex].currentCapacity + 1,
                    deliveryAssistants[assistantIndex].maxCapacity
                );
                filterDeliveryAssistants();
            }
            
        } catch (error) {
            console.error('Error sending delivery request:', error);
            showNotification('Failed to send pickup request. Please try again.', 'error');
        }
    }
    
    // Product Loading Functions
    function showProductLoading() {
        const loadingElement = document.getElementById('productsLoading');
        const errorElement = document.getElementById('productsError');
        
        if (loadingElement) {
            loadingElement.classList.add('visible');
        }
        if (errorElement) {
            errorElement.classList.remove('visible');
        }
        
        updateLoadingProgress(10);
        updateLoadingCount(0, '...');
    }
    
    function hideProductLoading() {
        const loadingElement = document.getElementById('productsLoading');
        if (loadingElement) {
            loadingElement.classList.remove('visible');
        }
    }
    
    function showProductError() {
        const loadingElement = document.getElementById('productsLoading');
        const errorElement = document.getElementById('productsError');
        
        hideProductLoading();
        
        if (errorElement) {
            errorElement.classList.add('visible');
        }
    }
    
    function retryLoadingProducts() {
        showProductLoading();
        loadProducts();
    }
    
    function updateLoadingProgress(progress) {
        const progressBar = document.getElementById('loadingProgressBar');
        if (progressBar) {
            progressBar.style.width = progress + '%';
        }
    }
    
    function updateLoadingCount(count, total) {
        const countElement = document.getElementById('loadingCount');
        if (countElement) {
            if (total === '...') {
                countElement.textContent = `${count} products loaded`;
            } else {
                countElement.textContent = `${count} of ${total} products loaded`;
            }
        }
    }
    
    // Load Products from Backend
    async function loadProducts() {
        if (isLoadingProducts) return;
        
        isLoadingProducts = true;
        
        try {
            console.log('ðŸ“¦ Loading franchise products...');
            
            updateLoadingProgress(30);
            
            // Use the franchise backend URL
            const response = await fetch(`${scriptUrl}?action=getProducts&timestamp=${Date.now()}`);
            
            if (response.ok) {
                const result = await response.json();
                
                if (result.success && Array.isArray(result.data)) {
                    allProducts = result.data.map(product => ({
                        id: product.id || `prod_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
                        name: product.name || 'Unnamed Product',
                        basePrice: parseFloat(product.basePrice) || parseFloat(product.price) || 0,
                        price: parseFloat(product.basePrice) || parseFloat(product.price) || 0,
                        image: product.image || product.images?.[0] || 'https://images.unsplash.com/photo-1586023492125-27b2c045efd7?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80',
                        category: product.category || product.collectionName || 'General',
                        description: product.description || 'Premium quality product for franchise orders.',
                        stock: product.stock || 10
                    }));
                    
                    console.log(`âœ… Loaded ${allProducts.length} products from franchise backend`);
                    
                    updateLoadingProgress(80);
                    updateLoadingCount(allProducts.length, allProducts.length);
                    
                    // Display products
                    displayProducts(allProducts);
                    
                    // Hide loading indicator
                    setTimeout(() => {
                        hideProductLoading();
                        const container = document.getElementById('productsContainer');
                        container.classList.add('loaded');
                    }, 500);
                    
                } else {
                    throw new Error('Invalid response format from franchise backend');
                }
            } else {
                throw new Error('Network response was not ok');
            }
            
        } catch (error) {
            console.error('âŒ Error loading products from franchise backend:', error);
            
            // Fallback to sample products
            loadSampleProducts();
            
        } finally {
            isLoadingProducts = false;
        }
    }
    
    function loadSampleProducts() {
        console.log('ðŸ“¦ Loading sample products as fallback...');
        
        // Sample franchise products
        allProducts = [
            {
                id: 'FR-CL001',
                name: 'Premium Franchise Hoodie',
                basePrice: 8999,
                price: 8999,
                image: 'https://images.unsplash.com/photo-1556821840-3a63f95609a7?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80',
                category: 'clothing',
                description: 'Premium franchise hoodie for official DSOG franchisees. Made with high-quality materials.',
                stock: 50
            },
            {
                id: 'FR-CL002',
                name: 'Franchise Polo Shirt',
                basePrice: 4550,
                price: 4550,
                image: 'https://images.unsplash.com/photo-1576566588028-4147f3842f27?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80',
                category: 'clothing',
                description: 'Official franchise polo shirt with DSOG branding.',
                stock: 75
            },
            {
                id: 'FR-AC001',
                name: 'Franchise Cap',
                basePrice: 2999,
                price: 2999,
                image: 'https://images.unsplash.com/photo-1588850561407-ed78c282e89b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80',
                category: 'accessories',
                description: 'DSOG franchise branded cap for staff and promotions.',
                stock: 100
            },
            {
                id: 'FR-HG001',
                name: 'Display Stand',
                basePrice: 14999,
                price: 14999,
                image: 'https://images.unsplash.com/photo-1586023492125-27b2c045efd7?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80',
                category: 'home-goods',
                description: 'Premium display stand for franchise store products.',
                stock: 20
            },
            {
                id: 'FR-NEW001',
                name: 'New Arrival Collection',
                basePrice: 24999,
                price: 24999,
                image: 'https://images.unsplash.com/photo-1513475382585-d06e58bcb0e0?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80',
                category: 'new',
                description: 'Latest collection items for franchise stores.',
                stock: 30
            }
        ];
        
        updateLoadingProgress(100);
        updateLoadingCount(allProducts.length, allProducts.length);
        
        displayProducts(allProducts);
        
        setTimeout(() => {
            hideProductLoading();
            const container = document.getElementById('productsContainer');
            container.classList.add('loaded');
        }, 500);
        
        showNotification('Loaded sample products for franchise orders');
    }
    
    function displayProducts(products) {
        const container = document.getElementById('productsContainer');
        
        // Clear existing products except loading/error states
        Array.from(container.children).forEach(child => {
            if (child.id !== 'productsLoading' && child.id !== 'productsError') {
                container.removeChild(child);
            }
        });
        
        // Filter products
        let filteredProducts = products;
        if (currentFilter !== 'all') {
            filteredProducts = products.filter(product => 
                product.category === currentFilter || 
                (currentFilter === 'new' && product.category === 'new')
            );
        }
        
        // Display products with staggered animation
        filteredProducts.forEach((product, index) => {
            setTimeout(() => {
                const productCard = createProductCard(product);
                container.appendChild(productCard);
            }, index * 50);
        });
    }
    
    function createProductCard(product) {
        const card = document.createElement('div');
        card.className = 'product-card';
        card.style.animationDelay = `${Math.random() * 0.3}s`;
        
        // Check if product is in cart
        const cartItem = cart.find(item => item.id === product.id);
        const quantityInCart = cartItem ? cartItem.quantity : 0;
        
        card.innerHTML = `
            <div class="product-image-wrapper">
                <img src="${product.image}" alt="${product.name}" class="product-image" loading="lazy">
                <button class="view-image-btn" onclick="event.stopPropagation(); openProductModal(${JSON.stringify(product).replace(/"/g, '&quot;')})">
                    <i class="fas fa-expand"></i>
                </button>
            </div>
            <div class="product-info">
                <div class="product-badge">${product.category}</div>
                <h3 class="product-title">${product.name}</h3>
                <div class="product-price">KSh ${product.price}</div>
                <button class="add-to-cart-btn ${quantityInCart > 0 ? 'added' : ''}" 
                        onclick="addToCartToProduct(${JSON.stringify(product).replace(/"/g, '&quot;')}, this)">
                    <i class="fas ${quantityInCart > 0 ? 'fa-check' : 'fa-cart-plus'}"></i>
                    ${quantityInCart > 0 ? `Added (${quantityInCart})` : 'Add to Cart'}
                </button>
            </div>
        `;
        
        // Add click event to open modal
        card.addEventListener('click', function(e) {
            if (!e.target.closest('.add-to-cart-btn') && !e.target.closest('.view-image-btn')) {
                openProductModal(product);
            }
        });
        
        return card;
    }
    
    // Global function for add to cart from product cards
    window.addToCartToProduct = function(product, buttonElement) {
        addToCart(product, buttonElement);
    };
    
    function openProductModal(product) {
        if (!userProfile || !userProfile.googleId) {
            showNotification('Please sign in first', 'error');
            return;
        }
        
        const modal = document.getElementById('productModal');
        const modalBody = document.getElementById('modalBody');
        
        // Check if product is in cart
        const cartItem = cart.find(item => item.id === product.id);
        const quantityInCart = cartItem ? cartItem.quantity : 0;
        
        modalBody.innerHTML = `
            <div class="modal-image-container">
                <img src="${product.image}" alt="${product.name}" class="modal-main-image">
            </div>
            <div class="modal-details">
                <h2 class="modal-title">${product.name}</h2>
                <div class="modal-price">KSh ${product.price}</div>
                <div class="modal-category">${product.category}</div>
                <p class="modal-description">${product.description}</p>
                <div style="margin-top: 1rem;">
                    <p><strong>Stock:</strong> ${product.stock} units available</p>
                    <p><strong>SKU:</strong> ${product.id}</p>
                </div>
                <button class="add-to-cart-btn ${quantityInCart > 0 ? 'added' : ''}" 
                        onclick="addToCartToProduct(${JSON.stringify(product).replace(/"/g, '&quot;')}, this); closeModal();"
                        style="margin-top: 2rem;">
                    <i class="fas ${quantityInCart > 0 ? 'fa-check' : 'fa-cart-plus'}"></i>
                    ${quantityInCart > 0 ? `Update Cart (${quantityInCart})` : 'Add to Cart'}
                </button>
            </div>
        `;
        
        openModal();
    }
    
    function filterProducts() {
        displayProducts(allProducts);
    }
    
    // Delivery Assistant Functions
    function showDeliveryLoading() {
        const loadingElement = document.getElementById('deliveryLoading');
        const errorElement = document.getElementById('deliveryError');
        
        if (loadingElement) {
            loadingElement.classList.add('visible');
        }
        if (errorElement) {
            errorElement.classList.remove('visible');
        }
    }
    
    function hideDeliveryLoading() {
        const loadingElement = document.getElementById('deliveryLoading');
        if (loadingElement) {
            loadingElement.classList.remove('visible');
        }
    }
    
    function showDeliveryError() {
        const loadingElement = document.getElementById('deliveryLoading');
        const errorElement = document.getElementById('deliveryError');
        
        hideDeliveryLoading();
        
        if (errorElement) {
            errorElement.classList.add('visible');
        }
    }
    
    function retryLoadingDeliveryAssistants() {
        showDeliveryLoading();
        loadDeliveryAssistants();
    }
    
    async function loadDeliveryAssistants() {
        if (isLoadingDelivery) return;
        
        isLoadingDelivery = true;
        showDeliveryLoading();
        
        try {
            console.log('ðŸšš Loading delivery assistants...');
            
            // Try to load from backend
            const response = await fetch(`${deliveryScriptUrl}?action=getDeliveryAssistants&timestamp=${Date.now()}`);
            
            if (response.ok) {
                const result = await response.json();
                
                if (result.success && Array.isArray(result.data)) {
                    deliveryAssistants = result.data.map(assistant => ({
                        id: assistant.id || `DA-${Date.now()}_${Math.random().toString(36).substr(2, 6)}`,
                        name: assistant.name || 'Unknown Assistant',
                        phone: assistant.phone || '+254700000000',
                        vehicle: assistant.vehicle || 'Vehicle not specified',
                        status: assistant.status || 'available',
                        currentCapacity: parseInt(assistant.currentCapacity) || 0,
                        maxCapacity: parseInt(assistant.maxCapacity) || 10,
                        rating: parseFloat(assistant.rating) || 4.5,
                        completedDeliveries: parseInt(assistant.completedDeliveries) || 0,
                        location: assistant.location || 'Location not specified',
                        zones: Array.isArray(assistant.zones) ? assistant.zones : 
                               (assistant.zones ? assistant.zones.split(',') : []),
                        lastUpdated: assistant.lastUpdated || new Date().toISOString(),
                        isActive: assistant.isActive !== false,
                        notes: assistant.notes || ''
                    }));
                    
                    console.log(`âœ… Loaded ${deliveryAssistants.length} delivery assistants from backend`);
                    
                } else {
                    // Fallback to sample data
                    loadSampleDeliveryAssistants();
                }
            } else {
                // Fallback to sample data
                loadSampleDeliveryAssistants();
            }
            
        } catch (error) {
            console.error('âŒ Error loading delivery assistants:', error);
            // Fallback to sample data
            loadSampleDeliveryAssistants();
        } finally {
            // Display assistants
            displayDeliveryAssistants(deliveryAssistants);
            
            // Hide loading indicator
            setTimeout(() => {
                hideDeliveryLoading();
                const container = document.getElementById('deliveryContainer');
                container.classList.add('loaded');
            }, 500);
            
            isLoadingDelivery = false;
        }
    }
    
    function loadSampleDeliveryAssistants() {
        console.log('ðŸšš Loading sample delivery assistants...');
        
        deliveryAssistants = [
            {
                id: 'DA001',
                name: 'John Kamau',
                phone: '+254712345678',
                vehicle: 'Toyota Probox - KDA 123A',
                status: 'available',
                currentCapacity: 3,
                maxCapacity: 10,
                rating: 4.8,
                completedDeliveries: 120,
                location: 'Nairobi CBD',
                zones: ['Nairobi', 'Thika', 'Kiambu'],
                lastUpdated: new Date().toISOString(),
                isActive: true,
                notes: 'Reliable and punctual'
            },
            {
                id: 'DA002',
                name: 'Susan Wanjiku',
                phone: '+254723456789',
                vehicle: 'Suzuki Every - KCB 456B',
                status: 'available',
                currentCapacity: 5,
                maxCapacity: 8,
                rating: 4.9,
                completedDeliveries: 95,
                location: 'Westlands',
                zones: ['Westlands', 'Parklands', 'Lavington'],
                lastUpdated: new Date().toISOString(),
                isActive: true,
                notes: 'Excellent customer service'
            },
            {
                id: 'DA003',
                name: 'Peter Odhiambo',
                phone: '+254734567890',
                vehicle: 'Nissan NV350 - KDC 789C',
                status: 'busy',
                currentCapacity: 8,
                maxCapacity: 12,
                rating: 4.7,
                completedDeliveries: 150,
                location: 'Industrial Area',
                zones: ['Industrial Area', 'South B', 'South C'],
                lastUpdated: new Date().toISOString(),
                isActive: true,
                notes: 'Handles large orders efficiently'
            },
            {
                id: 'DA004',
                name: 'Mary Achieng',
                phone: '+254745678901',
                vehicle: 'Toyota Sienta - KDD 012D',
                status: 'available',
                currentCapacity: 2,
                maxCapacity: 6,
                rating: 4.6,
                completedDeliveries: 80,
                location: 'Karen',
                zones: ['Karen', 'Langata', 'Rongai'],
                lastUpdated: new Date().toISOString(),
                isActive: true,
                notes: 'Specializes in fragile items'
            }
        ];
        
        console.log(`âœ… Loaded ${deliveryAssistants.length} sample delivery assistants`);
    }
    
    function displayDeliveryAssistants(assistants) {
        const container = document.getElementById('deliveryContainer');
        
        // Clear existing assistants except loading/error states
        Array.from(container.children).forEach(child => {
            if (child.id !== 'deliveryLoading' && child.id !== 'deliveryError') {
                container.removeChild(child);
            }
        });
        
        // Filter assistants
        let filteredAssistants = assistants;
        if (currentDeliveryFilter !== 'all') {
            filteredAssistants = assistants.filter(assistant => 
                assistant.status === currentDeliveryFilter
            );
        }
        
        // Display assistants with staggered animation
        filteredAssistants.forEach((assistant, index) => {
            setTimeout(() => {
                const deliveryCard = createDeliveryCard(assistant);
                container.appendChild(deliveryCard);
            }, index * 100);
        });
    }
    
    function createDeliveryCard(assistant) {
        const card = document.createElement('div');
        card.className = 'delivery-card';
        
        const capacityPercentage = (assistant.currentCapacity / assistant.maxCapacity) * 100;
        const capacityColor = capacityPercentage > 80 ? 'var(--light-red)' : 
                             capacityPercentage > 60 ? 'var(--primary-gold)' : 
                             'var(--success)';
        
        card.innerHTML = `
            <div class="delivery-card-header">
                <span class="delivery-status status-${assistant.status}">${assistant.status}</span>
                <h3 class="delivery-name">${assistant.name}</h3>
                <p class="delivery-id">ID: ${assistant.id}</p>
                <div class="delivery-vehicle">
                    <i class="fas fa-car"></i>
                    <span>${assistant.vehicle}</span>
                </div>
                <div class="delivery-rating">
                    <i class="fas fa-star"></i>
                    <span>${assistant.rating} (${assistant.completedDeliveries} deliveries)</span>
                </div>
            </div>
            <div class="delivery-card-body">
                <div class="delivery-info">
                    <div class="info-row">
                        <span class="info-label">Phone:</span>
                        <span class="info-value">${assistant.phone}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Location:</span>
                        <span class="info-value">${assistant.location}</span>
                    </div>
                </div>
                
                <div class="delivery-capacity">
                    <div class="capacity-label">Current Capacity</div>
                    <div class="capacity-bar">
                        <div class="capacity-fill" style="width: ${capacityPercentage}%; background: ${capacityColor};"></div>
                    </div>
                    <div class="capacity-text">${assistant.currentCapacity}/${assistant.maxCapacity} items</div>
                </div>
                
                <div class="delivery-buttons">
                    <button class="pickup-btn" onclick="openDeliveryModal(${JSON.stringify(assistant).replace(/"/g, '&quot;')})" ${assistant.status === 'busy' ? 'disabled' : ''}>
                        <i class="fas fa-truck-loading"></i>
                        ${assistant.status === 'busy' ? 'Currently Busy' : 'Request Pickup'}
                    </button>
                    <button class="whatsapp-btn" onclick="window.open('https://wa.me/${assistant.phone.replace(/\D/g, '')}', '_blank')">
                        <i class="fab fa-whatsapp"></i>
                    </button>
                </div>
            </div>
        `;
        
        return card;
    }
    
    function filterDeliveryAssistants() {
        displayDeliveryAssistants(deliveryAssistants);
    }
    
    // Franchise Order Submission
    async function submitFranchiseOrder() {
        if (!userProfile || !userProfile.googleId) {
            showNotification('Please sign in first', 'error');
            return;
        }
        
        const franchiseeName = document.getElementById('franchiseeName').value.trim();
        const franchiseePhone = document.getElementById('franchiseePhone').value.trim();
        const franchiseeLocation = document.getElementById('franchiseeLocation').value.trim();
        const orderNotes = document.getElementById('orderNotes').value.trim();
        
        // Validation
        if (!franchiseeName || !franchiseePhone || !franchiseeLocation) {
            showNotification('Please fill in all required fields', 'error');
            return;
        }
        
        if (cart.length === 0) {
            showNotification('Your cart is empty. Add products before submitting.', 'error');
            return;
        }
        
        // Calculate totals
        const totals = calculateCartTotal();
        
        // Build order data with Google user info
        const orderData = {
            action: 'submitFranchiseOrder',
            franchiseeName: franchiseeName,
            franchiseePhone: franchiseePhone,
            franchiseeLocation: franchiseeLocation,
            orderNotes: orderNotes,
            items: cart,
            subtotal: totals.subtotal,
            total: totals.total,
            orderDate: new Date().toISOString(),
            orderId: 'FR-' + Date.now().toString().slice(-8),
            googleUser: {
                id: userProfile.googleId,
                email: userProfile.email,
                name: userProfile.name
            }
        };
        
        try {
            // Submit to franchise backend
            const response = await fetch(scriptUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(orderData)
            });
            
            if (response.ok) {
                // Build WhatsApp message
                let whatsappMessage = `*FRANCHISE ORDER - DSOG STORES*%0A%0A`;
                whatsappMessage += `*Order ID:* ${orderData.orderId}%0A`;
                whatsappMessage += `*Date:* ${new Date().toLocaleDateString()}%0A`;
                whatsappMessage += `*Google Account:* ${userProfile.email}%0A%0A`;
                
                whatsappMessage += `*FRANCHISEE INFORMATION*%0A`;
                whatsappMessage += `Name: ${franchiseeName}%0A`;
                whatsappMessage += `Phone: ${franchiseePhone}%0A`;
                whatsappMessage += `Location: ${franchiseeLocation}%0A`;
                
                if (orderNotes) {
                    whatsappMessage += `Notes: ${orderNotes}%0A`;
                }
                
                whatsappMessage += `%0A*ORDER SUMMARY*%0A`;
                
                cart.forEach((item, index) => {
                    const itemTotal = item.price * item.quantity;
                    whatsappMessage += `${index + 1}. ${item.quantity}x ${item.name} - KSh ${item.price} each = KSh ${itemTotal}%0A`;
                });
                
                whatsappMessage += `%0ASubtotal: KSh ${totals.subtotal}%0A`;
                whatsappMessage += `*Total: KSh ${totals.total}*%0A%0A`;
                whatsappMessage += `_This order was placed via DSOG Franchise Platform_`;
                
                // Open WhatsApp
                const whatsappUrl = `https://wa.me/254733737983?text=${whatsappMessage}`;
                window.open(whatsappUrl, '_blank');
                
                // Clear cart but keep form data (it's auto-filled from profile)
                cart = [];
                localStorage.removeItem('dsog_franchise_cart');
                updateCartBadge();
                renderCart();
                
                document.getElementById('orderNotes').value = '';
                
                showNotification('Order submitted successfully! Opening WhatsApp...');
                
            } else {
                throw new Error('Failed to submit order to backend');
            }
            
        } catch (error) {
            console.error('Order submission error:', error);
            
            // Fallback: Direct WhatsApp order
            submitDirectWhatsAppOrder(franchiseeName, franchiseePhone, franchiseeLocation, orderNotes);
        }
    }
    
    function submitDirectWhatsAppOrder(franchiseeName, franchiseePhone, franchiseeLocation, orderNotes) {
        // Build WhatsApp message
        let whatsappMessage = `*FRANCHISE ORDER - DSOG STORES*%0A%0A`;
        whatsappMessage += `*Order ID:* FR-${Date.now().toString().slice(-8)}%0A`;
        whatsappMessage += `*Date:* ${new Date().toLocaleDateString()}%0A`;
        whatsappMessage += `*Google Account:* ${userProfile.email}%0A%0A`;
        
        whatsappMessage += `*FRANCHISEE INFORMATION*%0A`;
        whatsappMessage += `Name: ${franchiseeName}%0A`;
        whatsappMessage += `Phone: ${franchiseePhone}%0A`;
        whatsappMessage += `Location: ${franchiseeLocation}%0A`;
        
        if (orderNotes) {
            whatsappMessage += `Notes: ${orderNotes}%0A`;
        }
        
        whatsappMessage += `%0A*ORDER SUMMARY*%0A`;
        
        const totals = calculateCartTotal();
        
        cart.forEach((item, index) => {
            const itemTotal = item.price * item.quantity;
            whatsappMessage += `${index + 1}. ${item.quantity}x ${item.name} - KSh ${item.price} each = KSh ${itemTotal}%0A`;
        });
        
        whatsappMessage += `%0ASubtotal: KSh ${totals.subtotal}%0A`;
        whatsappMessage += `*Total: KSh ${totals.total}*%0A%0A`;
        whatsappMessage += `_This order was placed via DSOG Franchise Platform_`;
        
        // Open WhatsApp
        const whatsappUrl = `https://wa.me/254733737983?text=${whatsappMessage}`;
        window.open(whatsappUrl, '_blank');
        
        // Clear cart but keep form data
        cart = [];
        localStorage.removeItem('dsog_franchise_cart');
        updateCartBadge();
        renderCart();
        
        document.getElementById('orderNotes').value = '';
        
        showNotification('Opening WhatsApp to submit your order...');
    }
    
    // PWA Installation
    function initPWA() {
        if (window.matchMedia('(display-mode: standalone)').matches || 
            window.navigator.standalone === true) {
            isAppInstalled = true;
            console.log('ðŸ“± Franchise app is installed as PWA');
            hideInstallButton();
        }
        
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            console.log('ðŸ“± PWA installation available for franchise app');
            
            setTimeout(() => {
                if (!isAppInstalled && !isInstallPromptShown) {
                    showInstallButton();
                }
            }, 3000);
        });
        
        window.addEventListener('appinstalled', () => {
            isAppInstalled = true;
            deferredPrompt = null;
            console.log('âœ… Franchise PWA installed successfully');
            hideInstallPrompt();
            hideInstallButton();
            showNotification('Franchise app installed successfully!');
        });
        
        initInstallButtons();
        registerServiceWorker();
    }
    
    function registerServiceWorker() {
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/franchise-service-worker.js')
                .then(registration => {
                    console.log('âœ… Franchise Service Worker registered:', registration.scope);
                })
                .catch(error => {
                    console.log('âŒ Franchise Service Worker registration failed:', error);
                });
        }
    }
    
    function initInstallButtons() {
        const installBtn = document.getElementById('installAppBtn');
        const installNowBtn = document.getElementById('pwaInstallNow');
        const installLaterBtn = document.getElementById('pwaInstallLater');
        const installCloseBtn = document.getElementById('pwaInstallClose');
        
        if (installBtn) {
            installBtn.addEventListener('click', showInstallPrompt);
        }
        
        if (installNowBtn) {
            installNowBtn.addEventListener('click', installPWA);
        }
        
        if (installLaterBtn) {
            installLaterBtn.addEventListener('click', hideInstallPrompt);
        }
        
        if (installCloseBtn) {
            installCloseBtn.addEventListener('click', hideInstallPrompt);
        }
    }
    
    function showInstallButton() {
        const installBtn = document.getElementById('installAppBtn');
        if (installBtn) {
            installBtn.style.display = 'flex';
        }
    }
    
    function hideInstallButton() {
        const installBtn = document.getElementById('installAppBtn');
        if (installBtn) {
            installBtn.style.display = 'none';
        }
    }
    
    function showInstallPrompt() {
        if (isAppInstalled) {
            showNotification('Franchise app is already installed!');
            return;
        }
        
        if (!deferredPrompt) {
            showNotification('App installation not available on this device');
            return;
        }
        
        const installPrompt = document.getElementById('pwaInstallPrompt');
        if (installPrompt) {
            installPrompt.style.display = 'flex';
            isInstallPromptShown = true;
        }
    }
    
    function hideInstallPrompt() {
        const installPrompt = document.getElementById('pwaInstallPrompt');
        if (installPrompt) {
            installPrompt.style.display = 'none';
        }
    }
    
    async function installPWA() {
        if (!deferredPrompt) {
            showNotification('Installation not available');
            return;
        }
        
        try {
            deferredPrompt.prompt();
            const { outcome } = await deferredPrompt.userChoice;
            
            if (outcome === 'accepted') {
                console.log('âœ… User accepted franchise PWA installation');
                isAppInstalled = true;
                hideInstallPrompt();
                hideInstallButton();
            } else {
                console.log('âŒ User dismissed franchise PWA installation');
            }
            
            deferredPrompt = null;
        } catch (error) {
            console.error('Error installing franchise PWA:', error);
            showNotification('Error installing franchise app. Please try again.');
        }
    }
    
    // Notification system
    function showNotification(message, type = 'success') {
        const notification = document.createElement('div');
        notification.className = 'notification';
        
        if (type === 'error') {
            notification.style.background = 'var(--dark-red)';
        } else if (type === 'warning') {
            notification.style.background = 'var(--primary-gold)';
            notification.style.color = 'var(--primary-black)';
        }
        
        notification.textContent = message;
        
        document.body.appendChild(notification);
        
        setTimeout(() => {
            if (notification.parentNode) {
                notification.remove();
            }
        }, 3000);
    }
</script>
</body>
</html>
